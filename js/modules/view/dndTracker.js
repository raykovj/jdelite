define("modules/view/dndTracker",["modules/geometry/point","modules/graph/graphConstants","modules/settings/config","modules/diagram/diagramUtils","modules/flow/flowUtils"],function(e,t,r,g,n){function o(e){var r=this,o=e,i=t.dragMode().NONE,a=void 0;r.setDragMode=function(e){i=e},r.getDragMode=function(){return i},r.setGalleryIcon=function(e){a=e},r.getGalleryIcon=function(){return a},r.clearTracking=function(){i=t.dragMode().NONE,r.resetNodesDNDFlags()},r.isSegmentDropAllowed=function(e,r,g,i,a,l){var d,s,f,p,u,c=o.getFlowLayout().getLevels(),P=o.getFlowLayout().getLanes();if(a.getType()===t.pipeType().LEVEL_PIPE){f=n.getLaneIndexAtPoint(g,P),p=n.getLaneIndexAtPoint(i,P),d=a.getOrder(),s=l.getOrder(),d>s?d--:s--;var O=Math.min(d,s),N=Math.max(d,s);for(u=O;u<=N;u++)if(f>=0&&c[u].getCellAtLane(f)||p>=0&&c[u].getCellAtLane(p))return!1}else if(a.getType()===t.pipeType().LANE_PIPE){d=n.getLevelIndexAtPoint(g,c),s=n.getLevelIndexAtPoint(i,c),f=a.getOrder(),p=l.getOrder(),f>p?f--:p--;var y=Math.min(f,p),m=Math.max(f,p);for(u=y;u<=m;u++)if(d>=0&&P[u].getCellAtLevel(d)||s>=0&&P[u].getCellAtLevel(s))return!1}var v=e.getSegments();for(u=0;u<v.length;u++)if(v[u].getOrder()!==r.getOrder()&&v[u].getType()===t.segmentType().IN_PIPE){if(v[u].getPipe().equals(l))return!1;if(v[u].getPipe().getType()===a.getType()){if(l.getOrder()>a.getOrder()&&v[u].getPipe().getOrder()>a.getOrder()&&l.getOrder()>v[u].getPipe().getOrder())return!1;if(l.getOrder()<a.getOrder()&&v[u].getPipe().getOrder()<a.getOrder()&&l.getOrder()<v[u].getPipe().getOrder())return!1}}return!0},r.setAcceptedDestinations=function(e,t){for(var r=o.getFlowDiagram().getFlowNodes(),g=e.getNode(),n=0;n<r.length;n++)r[n].hideRefPorts(),r[n].equals(g)||r[n].setDNDAcceptingPorts(e,t)},r.resetNodesDNDFlags=function(){for(var e=o.getFlowDiagram().getFlowNodes(),t=0;t<e.length;t++)e[t].resetDNDFlags()},r.getAcceptingPortForPoint2=function(e,t){for(var r=o.getFlowDiagram().getFlowNodes(),g=e.getNode(),n=0;n<r.length;n++)if(!r[n].equals(g)){var i=r[n].getAcceptingPortForPoint(e,t);if(i)return i}},r.getAcceptingPortForPoint3=function(e,g,n){return n&&(n.getType(),t.portType().LINK_CNX),n.containsPoint(g)?n:r.getAcceptingPortForPoint2(e,g)},r.canDropOnLink=function(e){var r=g.getFlowTypeForGalleryId(e);return r===t.flowType().PROCESS||r===t.flowType().DECISION||r===t.flowType().IN_OUT}}return o});