define("modules/flow/flowManager",["jquery","knockout","modules/layout/flowLayout","modules/diagram/flowDiagram","modules/view/dndHandler","modules/flow/modelHandler","modules/flow/fileNamesCache","modules/controller/flowController","modules/undo/undoManager","modules/diagram/mouseInteractor","modules/selection/selectionManager","modules/common/map","modules/diagram/diagramUtils","modules/graph/graphConstants","modules/settings/config","modules/util/utils","modules/dialogs/messageDialog"],function(e,n,t,a,o,i,r,s,u,l,d,f,g,c,m,v,w){function h(e){function g(){y.resetLinksToDefaults();var e=y.getModelObject();y.buildContentModel(e,!1),U.performLayout(),c(),h.adjustCanvas(),M.updateWindow(),h.paintDiagram()}function c(){R.clear();for(var e=U.getFlowNodes(),n=0;n<e.length;n++)v.addToNamesMap(R,e[n].getName(),e[n].getFlowType())}var h=this,p="Undo",D="Redo",N=!1,C=!1,M=e;h.getCaller=function(){return M};var F=M.getCanvas();h.getCanvas=function(){return M.getCanvas()};var y=new i(this);h.getModelHandler=function(){return y},h.flowLayout=new t(this),h.getFlowLayout=function(){return h.flowLayout};var U=new a(this);h.getFlowDiagram=function(){return U};var L=new u(this);h.getUndoManager=function(){return L};var S=new d(this);h.getSelectionManager=function(){return S};var j=new l(this);h.getMouseInteractor=function(){return j};var P=new s(this);h.getFlowController=function(){return P};var b=new o(this);h.getDnDHandler=function(){return b},h.fileName=n.observable(""),h.getFileName=function(){return h.fileName()};var R=new f;h.getNodeNamesMap=function(){return R};var T;h.isInitialResizeMode=function(){return T};var k;h.getTitle=function(){return k()},h.getWorkDir=function(){return""},h.isControlPressed=function(){return M.isControlPressed()},h.isShiftPressed=function(){return M.isShiftPressed()},h.clearDiagram=function(){R.clear(),h.fileName(""),U.clearCanvas(),T=!0,y.buildContentModel(void 0,!1),U.performLayout(),h.adjustCanvas(),M.updateWindow(),h.paintDiagram()},h.hasDiagramOpen=function(){return h.getFileName().length>0},h.createDiagram=function(e){R.clear(),p="Undo",D="Redo",h.fileName(e);var n={};n.title=e,n.nodes=[],n.links=[],T=!0,m.setCanvasReference(F),n.settings=y.getDefaultSettings(),y.updateSettings(n),h.resetUndoManager(),N=!1,y.buildContentModel(n,!1),U.performLayout(),h.adjustCanvas(),M.updateWindow(),h.paintDiagram()},h.openDiagram=function(e){return U.clearCanvas(),h.fileName(e),[]},h.processFlowData=function(e){k=e.title,T=!1,m.setCanvasReference(F),y.updateSettings(e),h.resetUndoManager(),N=!1,y.buildContentModel(e,!0),U.performLayout(),c(),h.adjustCanvas(),r.addFileName(h.fileName()),M.updateWindow(),h.paintDiagram()},h.refreshDiagramFromToolbar=function(){U.clearCanvas(),setTimeout(g,100)},h.refreshDiagram=function(){U.clearCanvas(),0!==h.fileName().length&&g()},h.adjustCanvas=function(){var e=U.getRectBounds(),n=F.getContext("2d");n.canvas.width=e.width+2,n.canvas.height=e.height+3},h.paintDiagram=function(){U.paintDiagram(),M.requestFocus()},h.showTooltip=function(e){U.showTooltip(e)},h.getFilesList=function(){M.setFilesList([])},h.getDirsList=function(){},h.sendFilesList=function(e){M.setFilesList(e)},h.sendDirsList=function(e){},h.saveFlowData=function(){if(y.clearIndexProperties(),T=!1,"json"===v.getFileExtension(h.fileName())){var e={},n=y.getModelObjectToSave();e.title=h.fileName(),e.nodes=n.nodes,e.links=n.links,e.settings=n.settings;JSON.stringify(e,null,2);r.addFileName(h.fileName()),N=!1,h.resetUndoManager(),M.updateWindow(),M.showSaveMessage()}else w.showMessage("Error","Incorrect file name: "+h.fileName())},h.saveFlowDataAs=function(e){if(y.clearIndexProperties(),T=!1,"json"===v.getFileExtension(e)){var n={},t=y.getModelObjectToSave();n.title=e,n.nodes=t.nodes,n.links=t.links,n.settings=t.settings;JSON.stringify(n,null,2);r.addFileName(e),N=!1,h.resetUndoManager(),M.updateWindow(),M.showSaveMessage()}else w.showMessage("Error","Incorrect file name: "+h.fileName())},h.hasNextDiagram=function(){return r.hasNext()},h.getNextDiagram=function(){var e=r.getNext();h.openDiagram(e)},h.hasPreviousDiagram=function(){return r.hasPrevious()},h.getPreviousDiagram=function(){var e=r.getPrevious();h.openDiagram(e)},h.setDirty=function(e){C=e,M.updateWindow()},h.isDirty=function(){return C||N},h.setSettingsChanged=function(e){N=N||e},h.resetUndoManager=function(){L.clearAll(),C=!1},h.canUndo=function(){return L.canUndo()},h.canRedo=function(){return L.canRedo()},h.isUndoBufferEmpty=function(){return L.isUndoBufferEmpty()},h.resetUndoProperties=function(){},h.setUndoName=function(e){p=e},h.getUndoName=function(){return p},h.setRedoName=function(e){D=e},h.getRedoName=function(){return D}}return h});