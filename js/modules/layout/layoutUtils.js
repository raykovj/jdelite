define("modules/layout/layoutUtils",["modules/geometry/point","modules/graph/xPoint","modules/geometry/rectangle","modules/graph/cell","modules/graph/graphElement","modules/graph/graphNode","modules/graph/connector","modules/graph/corridor","modules/graph/segment","modules/graph/segmentChannel","modules/graph/segmentPoint","modules/diagram/diagramUtils","modules/graph/graphConstants"],function(e,t,n,r,g,a,i,o,s,u,l,f,h){var m=Math.floor(h.segmentsGap().MIN),S=function(e,t,n,r,g,a,i){if(e.y==t.y&&e.x!=t.x&&n.y==r.y&&n.x!=r.x){var o=Math.min(e.x,t.x),s=Math.max(e.x,t.x);if(n.x+a+i>=o-g&&n.x-a-i<=s+g||r.x+a+i>=o-g&&r.x-a-i<=s+g)return!0;var u=Math.min(n.x,r.x),l=Math.max(n.x,r.x);if(e.x+g+i>=u-a&&e.x-g-i<=l+a||t.x+g+i>=u-a&&t.x-g-i<=l+a)return!0}else if(e.y!=t.y&&e.x==t.x&&n.y!=r.y&&n.x==r.x){var f=Math.min(e.y,t.y),h=Math.max(e.y,t.y);if(n.y+a+i>=f-g&&n.y-a-i<=h+g||r.y+a+i>=f-g&&r.y-a-i<=h+g)return!0;var m=Math.min(n.y,r.y),S=Math.max(n.y,r.y);if(e.y+g+i>=m-a&&e.y-g-i<=S+a||t.y+g+i>=m-a&&t.y-g-i<=S+a)return!0}return!1},x=function(e,t){if(!e||!t)return!1;var n=e.getStartPoint(),r=e.getEndPoint(),g=Math.min(n.x,r.x),a=Math.min(n.y,r.y),i=Math.max(n.x,r.x),o=Math.max(n.y,r.y),s=t.getStartPoint(),u=t.getEndPoint(),l=Math.min(s.x,u.x),f=Math.min(s.y,u.y),h=Math.max(s.x,u.x),m=Math.max(s.y,u.y),S=Math.floor(e.getThickness()/2)>0?Math.floor(e.getThickness()/2):1,x=Math.floor(t.getThickness()/2)>0?Math.floor(t.getThickness()/2):1;if(a===o&&g!==i){if(l===h&&f!==m)return!(f-x>a+S&&m-x>a+S||f+x<a-S&&m+x<a-S)&&!(g-S>l+x&&i-S>l+x||g+S<l-x&&i+S<l-x)}else if(g===i&&a!==o&&f===m&&l!==h)return!(l-x>g+S&&h-x>g+S||l+x<g-S&&h+x<g-S)&&!(a-S>f+x&&o-S>f+x||a+S<f-x&&o+S<f-x);return!1},c=function(e,t,n){var r=Math.floor(e.getThickness()/2)>0?Math.floor(e.getThickness()/2):1;return v(e.getStartPoint(),r,t,n)||v(e.getEndPoint(),r,t,n)},v=function(e,t,n,r){var g=n.getStartPoint(),a=n.getEndPoint(),i=Math.floor(n.getThickness()/2)>0?Math.floor(n.getThickness()/2):1;if(g.y==a.y){var o=Math.min(g.x,a.x)-i,s=Math.max(g.x,a.x)+i;if(e.x+t+r>=o&&e.x-t-r<=s){if(e.y==g.y)return!0;if(e.y>g.y){if(e.y-t-r<g.y+i)return!0}else if(e.y<g.y&&e.y+t+r>g.y-i)return!0}}else if(g.x==a.x){var u=Math.min(g.y,a.y)-i,l=Math.max(g.y,a.y)+i;if(e.y+t+r>=u&&e.y-t-r<=l){if(e.x==g.x)return!0;if(e.x>g.x){if(e.x-t-r<g.x+i)return!0}else if(e.x<g.x&&e.x+t+r>g.x-i)return!0}}return!1},y=function(e,t){var n=e.getStartPoint(),r=e.getEndPoint(),g=t.getStartPoint(),a=t.getEndPoint(),i=Math.floor(e.getThickness()/2),o=Math.floor(t.getThickness()/2);if(n.y==r.y&&g.y==a.y&&n.y==g.y){var s=Math.min(n.x,r.x),u=Math.max(n.x,r.x);if(g.x+o>=s-i&&g.x-o<=u+i||a.x+o>=s-i&&a.x-o<=u+i)return!0;var l=Math.min(g.x,a.x),f=Math.max(g.x,a.x);if(n.x+i>=l-o&&n.x-i<=f+o||r.x+i>=l-o&&r.x-i<=f+o)return!0}else if(n.x==r.x&&g.x==a.x&&n.x==g.x){var h=Math.min(n.y,r.y),m=Math.max(n.y,r.y);if(g.y+o>=h-i&&g.y-o<=m+i||a.y+o>=h-i&&a.y-o<=m+i)return!0;var S=Math.min(g.y,a.y),x=Math.max(g.y,a.y);if(n.y+i>=S-o&&n.y-i<=x+o||r.y+i>=S-o&&r.y-i<=x+o)return!0}return!1},P=function(e,t,n){for(var r=0;r<e.getSegments().length;r++)for(var g=0;g<t.getSegments().length;g++)if(b(e.getSegments()[r],t.getSegments()[g],n))return!0;return!1},d=function(e,t,n){var r=e.getStartPoint(),g=e.getEndPoint(),a=t.getStartPoint(),i=t.getEndPoint(),o=Math.floor(e.getThickness()/2),s=Math.floor(t.getThickness()/2),u=o+n+s;if(r.y==g.y&&a.y==i.y){if(Math.abs(r.y-a.y)<u)return S(r,g,a,i,o,s,n)}else if(r.x==g.x&&a.x==i.x&&Math.abs(r.x-a.x)<u)return S(r,g,a,i,o,s,n);return!1},E=function(e,t,n){for(var r=0;r<e.length;r++){var g=e[r];if(g.getOrder()!==t.getOrder())for(var a=g.getSegments(),i=0;i<a.length;i++){var o=a[i];if(!o.isSiblingWith(n)&&T(o,n,m))return!0}}return!1},T=function(e,t,n){var r=p(e,t,n);if(r&&r.length>1){var g=r[0].getSegment(),a=r[1].getSegment(),i=g.getEdge().getAdjacentSegment(g,r[0].getPoint()),o=a.getEdge().getAdjacentSegment(a,r[1].getPoint());if(i&&o&&d(i,o,n))return!0}return!1},p=function(e,t,n){var r=e.getStartPoint(),g=e.getEndPoint(),a=t.getStartPoint(),i=t.getEndPoint(),o=Math.floor(e.getThickness()/2),s=Math.floor(t.getThickness()/2),u=o+n+s;return Math.abs(a.x-r.x)<u||Math.abs(a.y-r.y)<u?[new l(e,h.segmentPointDef.START),new l(t,h.segmentPointDef.START)]:Math.abs(i.x-r.x)<u||Math.abs(i.y-r.y)<u?[new l(e,h.segmentPointDef.START),new l(t,h.segmentPointDef.END)]:Math.abs(a.x-g.x)<u||Math.abs(a.y-g.y)<u?[new l(e,h.segmentPointDef.END),new l(t,h.segmentPointDef.START)]:Math.abs(i.x-g.x)<u||Math.abs(i.y-g.y)<u?[new l(e,h.segmentPointDef.END),new l(t,h.segmentPointDef.END)]:null},M=function(e,t,n){for(var r=t.getSegments(),g=0;g<r.length;g++)if(!r[g].equals(e)&&C(e,r[g]))return!0;return!1},C=function(e,t){var n=e.getEdge().getPreviousSegment(e),r=e.getEdge().getNextSegment(e);if(!n||!r)return!1;var g=t.getEdge().getPreviousSegment(t),a=t.getEdge().getNextSegment(t);return!(!g||!a)&&((x(e,g)||x(e,a))&&(x(t,n)||x(t,r)))},k=function(e,t,n){for(var r=t.getSegments(),g=0;g<r.length;g++)if(!r[g].equals(e)&&O(e,r[g]))return!0;return!1},O=function(e,t){var n=e.getEdge().getPreviousSegment(e),r=e.getEdge().getNextSegment(e);if(!n||!r)return!1;var g=t.getEdge().getPreviousSegment(t),a=t.getEdge().getNextSegment(t);return!(!g||!a)&&(x(e,g)&&x(e,a)||x(t,n)&&x(t,r))},I=function(e,t,n,r){for(var g=e.getSegments(),a=0;a<g.length;a++){var i=g[a];if(!i.equals(t)&&b(i,n,r))return!0}return!1},_=function(e,t,n){for(var r=[],g=0;g<e.length;g++){var a=e[g];N(a,t,n)||r.push(a)}return r},N=function(e,t,n){for(var r=e.getSegments(),g=0;g<r.length;g++){var a=r[g];if(b(a,t,n))return!0}return!1},b=function(t,n,r){var g=t.getStartPoint(),a=t.getEndPoint(),i=Math.min(g.x,a.x),o=Math.min(g.y,a.y),s=new e(i,o),u=Math.max(g.x,a.x),l=Math.max(g.y,a.y),f=new e(u,l),h=n.getStartPoint(),m=n.getEndPoint(),x=Math.min(h.x,m.x),c=Math.min(h.y,m.y),v=new e(x,c),y=Math.max(h.x,m.x),P=Math.max(h.y,m.y),d=new e(y,P),E=Math.floor(t.getThickness()/2)>0?Math.floor(t.getThickness()/2):1,T=Math.floor(n.getThickness()/2)>0?Math.floor(n.getThickness()/2):1;return S(s,f,v,d,E,T,r)},X=function(e){var t=h.result().OK,n=(e.getType()===h.pipeType().LEVEL_PIPE&&e.getOrder(),!1);if(e.getChannels().length>0)for(var r=0;r<e.getChannels().length;r++){for(var g=e.getChannels()[r],a=0;a<g.getSegments().length;a++){for(var i=g.getSegments()[a],o=a+1;o<g.getSegments().length;o++){var s=g.getSegments()[o],u=y(i,s)||d(i,s,m);if(u&&(t=L(e,g,s),t===h.result().OK&&(t=h.result().HAS_FIX),n=!0),n)break}if(n)break}if(n)break}return t},A=function(e,t){var n=h.result().OK,r=!1;e.getType()===h.pipeType().LEVEL_PIPE&&e.getOrder();if(e.getChannels().length>1)for(var g=0;g<e.getChannels().length;g++){for(var a=e.getChannels()[g],i=0;i<a.getSegments().length;i++){for(var o=a.getSegments()[i],s=g+1;s<e.getChannels().length;s++){for(var u=e.getChannels()[s],l=0;l<u.getSegments().length;l++){var f=u.getSegments()[l],S=b(o,f,0);if(S)if(t===h.pipeXing().SIDE_BOX){if(C(o,f)){N(a,f,m)||N(u,o,m)?(D(e,g,o,s,f),n=h.result().RETRY_FIX):(e.swapSegments(a,o,u,f),n=h.result().HAS_FIX),r=!0;break}}else if(t===h.pipeXing().CROSS_BOX&&O(o,f)){N(a,f,m)||N(u,o,m)?(D(e,g,o,s,f),n=h.result().RETRY_FIX):(e.swapSegments(a,o,u,f),n=h.result().HAS_FIX),r=!0;break}}if(r)break}if(r)break}if(r)break}return n},F=function(e,t,n,r,g){var a=e.getSegmentChannel(n),i=e.getSegmentChannel(g),o=n.getChannelIndex(),s=g.getChannelIndex(),u=Math.max(o,s)+1;e.insertEmptyChannelAtIndex(u);var l=e.getChannels()[u];o<s?e.moveSegment(n,a,l):o>s&&e.moveSegment(g,i,l)},D=function(e,t,n,r,g){var a=e.getSegmentChannel(n),i=(e.getSegmentChannel(g),Math.max(t,r)+1);if(i<e.getChannels().length&&!N(e.getChannels()[i],n,m))e.moveSegment(n,a,e.getChannels()[i]);else{e.insertEmptyChannelAtIndex(i);var o=e.getChannels()[i];e.moveSegment(n,a,o)}},w=function(e,t,n,r){var g=e.getConnector(),a=g.getOrder(),i=n.getConnector(),o=i.getOrder(),s=i.x-g.x,u=i.y-g.y;g.translate(s,u),t.adjustStartPoint(s,u),t.adjustEndPoint(s,u),g.setOrder(o),i.translate(-s,-u),r.adjustStartPoint(-s,-u),r.adjustEndPoint(-s,-u),i.setOrder(a)},K=function(e,t,n){for(var r=h.result().OK,g=!1,a=[],i=0;i<t.length;i++){var o=t[i].getSourceSegment();o&&a.push(o)}if(a.length<=1)return r;for(var s=0;s<a.length;s++){for(var u=a[s],l=s+1;l<a.length;l++){var f=a[l];if(!u.getStartPoint().equals(f.getStartPoint())){var m=u.getEdge(),S=f.getEdge(),c=m.getNextSegment(u),v=(c&&m.getNextSegment(c),S.getNextSegment(f));v&&S.getNextSegment(v);if(x(u,v)||x(f,c)){var P=u.getEdge().getSourcePort(),d=f.getEdge().getSourcePort();if(w(P,u,d,f),y(c,v)){var E=n.getSegmentChannel(c),T=n.getSegmentChannel(v);E&&T&&(r=L(n,T,v))===h.result().OK&&(r=h.result().HAS_FIX)}else r=h.result().HAS_FIX;g=!0;break}if(g)break}}if(g)break}return r},R=function(e,t,n){for(var r=h.result().OK,g=!1,a=[],i=0;i<t.length;i++){var o=t[i].getSourceSegment();o&&a.push(o)}if(a.length<=1)return r;for(var s=0;s<a.length;s++){for(var u=a[s],l=s+1;l<a.length;l++){var f=a[l],S=u.getEdge(),c=f.getEdge(),v=S.getNextSegment(u),P=v?S.getNextSegment(v):null,d=c.getNextSegment(f),E=d?c.getNextSegment(d):null;if(x(v,E)||x(d,P)){var T=u.getEdge().getSourcePort(),p=f.getEdge().getSourcePort();w(T,u,p,f);var M=n.getSegmentChannel(v),k=n.getSegmentChannel(d);if(!M||!k)continue;if(C(v,d)||O(v,d)){N(M,d,m)||N(k,v,m)?(F(n,0,v,0,d),r=h.result().RETRY_FIX):(n.swapSegments(M,v,k,d),r=h.result().HAS_FIX),g=!0;break}y(v,d)?M&&k&&(r=L(n,k,d))===h.result().OK&&(r=h.result().HAS_FIX):r=h.result().HAS_FIX,g=!0}if(g)break}if(g)break}return r},H=function(e,t,n){for(var r=h.result().OK,g=!1,a=[],i=0;i<t.length;i++){var o=t[i].getEndSegment();o&&a.push(o)}if(a.length<=1)return r;for(var s=0;s<a.length;s++){for(var u=a[s],l=s+1;l<a.length;l++){var f=a[l];u.getEndPoint().equals(f.getEndPoint());var m=u.getEdge(),S=f.getEdge(),c=u.getEdge().getPreviousSegment(u),v=(c&&m.getPreviousSegment(c),f.getEdge().getPreviousSegment(f));v&&S.getPreviousSegment(v);if(x(u,v)||x(f,c)){var P=u.getEdge().getTargetPort(),d=f.getEdge().getTargetPort();if(w(P,u,d,f),y(c,v)){var E=n.getSegmentChannel(c),T=n.getSegmentChannel(v);E&&T&&(r=L(n,T,v))===h.result().OK&&(r=h.result().HAS_FIX)}else r=h.result().HAS_FIX;g=!0;break}if(g)break}if(g)break}return r},j=function(e,t,n){for(var r=h.result().OK,g=!1,a=[],i=0;i<t.length;i++){var o=t[i].getEndSegment();o&&a.push(o)}if(a.length<=1)return r;for(var s=0;s<a.length;s++){for(var u=a[s],l=s+1;l<a.length;l++){var f=a[l];u.getEndPoint().equals(f.getEndPoint());var m=u.getEdge(),S=f.getEdge(),c=u.getEdge().getPreviousSegment(u),v=c?m.getPreviousSegment(c):null,P=f.getEdge().getPreviousSegment(f),d=P?S.getPreviousSegment(P):null;if(x(c,d)||x(P,v)){var E=u.getEdge().getTargetPort(),T=f.getEdge().getTargetPort();if(w(E,u,T,f),y(c,P)){var p=n.getSegmentChannel(c),M=n.getSegmentChannel(P);p&&M&&(r=L(n,M,P))===h.result().OK&&(r=h.result().HAS_FIX)}else r=h.result().HAS_FIX;g=!0}if(g)break}if(g)break}return r},B=function(e,t,n){var r=h.result().OK;if(t.length<=1)return r;for(var g=0;g<t.length;g++){var a,i,o=t[g],s=o.getEdge();if(o.getType()===h.segmentType().NODE_TO_PIPE)a=s.getNextSegment(o),a?s.getNextSegment(a):null,i=s.getSourcePort();else{if(o.getType()!==h.segmentType().PIPE_TO_NODE)continue;a=s.getPreviousSegment(o),a?s.getPreviousSegment(a):null,i=s.getTargetPort()}for(var u=n.getSegmentChannel(a),l=g+1;l<t.length;l++){var f,m,S=t[l],c=S.getEdge();if(S.getType()===h.segmentType().NODE_TO_PIPE)f=c.getNextSegment(S),f?c.getNextSegment(f):null,m=c.getSourcePort();else{if(S.getType()!==h.segmentType().PIPE_TO_NODE)continue;f=c.getPreviousSegment(S),f?c.getPreviousSegment(f):null,m=c.getTargetPort()}var v=n.getSegmentChannel(f);(x(o,f)||x(S,a))&&(w(i,o,m,S),(C(a,f)||O(a,f))&&(u=n.getSegmentChannel(a),v=n.getSegmentChannel(f),u&&v&&(r=L(n,v,f))===h.result().OK&&(r=h.result().HAS_FIX)))}}return r},q=function(e,t,n){var r,g,a=h.result().OK,i=!1;if(t.length<=1)return a;n.getType()===h.pipeType().LANE_PIPE&&n.getOrder();for(r=0;r<t.length;r++){var o,s,u,l=t[r],f=l.getEdge();if(l.getType()===h.segmentType().NODE_TO_PIPE)o=f.getNextSegment(l),s=o?f.getNextSegment(o):null,u=f.getSourcePort();else{if(l.getType()!==h.segmentType().PIPE_TO_NODE)continue;o=f.getPreviousSegment(l),s=o?f.getPreviousSegment(o):null,u=f.getTargetPort()}var S=n.getSegmentChannel(o);if(S){for(g=r+1;g<t.length;g++){var c,v,y,P=t[g],d=P.getEdge();if(P.getType()===h.segmentType().NODE_TO_PIPE)c=d.getNextSegment(P),v=c?d.getNextSegment(c):null,y=d.getSourcePort();else{if(P.getType()!==h.segmentType().PIPE_TO_NODE)continue;c=d.getPreviousSegment(P),v=c?d.getPreviousSegment(c):null,y=d.getTargetPort()}var E=n.getSegmentChannel(c);if(E){if(x(o,v)||x(c,s)){if(w(u,l,y,P),C(o,c)||O(o,c)){N(S,c,m)||N(E,o,m)?(F(n,0,o,0,c),a=h.result().RETRY_FIX):(n.swapSegments(S,o,E,c),a=h.result().HAS_FIX),i=!0;break}i=!0;break}if(i)break}}if(i)break}}return a},L=function(e,t,n){var r,g,a=_(e.getChannels(),n,m);return 0===a.length?(r=e.incrementChannels(),g=h.result().RETRY_FIX):(r=a[0],g=h.result().OK),e.moveSegment(n,t,r),g};return{areProjectionsOverlapping:function(e,t,n,r,g,a,i){return S(e,t,n,r,g,a,i)},areIntersecting:function(e,t){return x(e,t)},isSegmentInViolationToSegment:function(e,t,n){return c(e,t,n)},isPointInViolation:function(e,t,n,r){return v(e,t,n,r)},areOverlapping:function(e,t){return y(e,t)},haveChannelsProjectionsOverlapping:function(e,t,n){return P(e,t,n)},hasSegmentConflictsInChanel:function(e,t,n){return N(e,t,n)},areSegmentsInClearanceViolation:function(e,t,n){return d(e,t,n)},hasSegmentConflicts:function(e,t,n){return E(e,t,n)},areSegmentsInProximityViolation:function(e,t,n){return T(e,t,n)},getEndsWithinProximity:function(e,t,n){return p(e,t,n)},areSegment2ChannelSideBox:function(e,t,n){return M(e,t)},areSegmentsInSideBox:function(e,t){return C(e,t)},areSegment2ChannelCrossBox:function(e,t,n){return k(e,t)},areSegmentsInCrossBox:function(e,t){return O(e,t)},hasChannelConflicts:function(e,t,n,r){return I(e,t,n,r)},getNoConflictChannels:function(e,t,n){return _(e,t,n)},areSegmentsProjectionsOverlapping:function(e,t,n){return b(e,t,n)},checkOverlappingSegmentsInChannel:function(e){return X(e)},checkSegmentsForCrossings:function(e,t){return A(e,t)},swapPortsLocations:function(e,t,n,r){return w(e,t,n,r)},checkFrontCrossings:function(e,t,n){return K(0,t,n)},checkFrontCrossingsNEXT:function(e,t,n){return R(0,t,n)},checkBackCrossings:function(e,t,n){return H(0,t,n)},checkBackCrossingsNEXT:function(e,t,n){return j(0,t,n)},checkSideCrossings:function(e,t,n){return B(0,t,n)},checkSideCrossingsNEXT:function(e,t,n){return q(0,t,n)}}});