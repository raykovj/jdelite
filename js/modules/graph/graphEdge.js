define("modules/graph/graphEdge",["modules/graph/graphElement","modules/geometry/rectangle","modules/settings/config","modules/graph/graphConstants","modules/core/jsUtils"],function(e,t,n,s,r){function g(n){function r(){for(var e=[],t=0;t<v.length;t++){for(var n,s=v[t],r=0;r<e.length;r++)if(e[r].order===s.order){e[r].pipeShift+=s.pipeShift,n=!0;break}if(!n){var g={};g.order=s.order,g.pipeShift=s.pipeShift,e.push(g)}}return e}function g(e){for(var n=0;n<u.segments.length;n++){var s=u.segments[n].getStartPoint(),r=u.segments[n].getEndPoint();if(s.y===r.y){var g=Math.min(s.x,r.x),i=Math.max(s.x,r.x);if(new t(g,s.y-3,Math.abs(g-i),6).containsXY(e.x,e.y))return u.segments[n]}else if(s.x===r.x){var o=Math.min(s.y,r.y),a=Math.max(s.y,r.y),m=new t(s.x-3,o,6,Math.abs(o-a));if(m.containsXY(e.x,e.y))return u.segments[n]}}}function i(e,t){for(var n=[],s=0;s<e.length;s++)e[s].getStartPoint().equals(t)&&n.push(e[s]);return n}function o(e,t){for(var n=0;n<e.length;n++)if(e[n].equals(t))return n;return-1}function a(e){for(var t=0;t<e.length;t++)if(e[t].getStartPoint().equals(e[t].getEndPoint()))return e[t]}e.call(this,new t(0,0,0,0));var u=this;u.setName(n),u.setId(s.elementType().EDGE),u.type=void 0,u.setType=function(e){u.type=e},u.getType=function(){return u.type},u.drawMode=s.drawMode().SEGMENTS,u.setDrawMode=function(e){u.drawMode=e},u.getDrawMode=function(){return u.drawMode},u.segments=[],u.getSegments=function(){return u.segments},u.hasSegmentsChained=!1;var m=s.portShift().NONE,f=s.portShift().NONE,c=-1,h=-1,l=!1,d=void 0;u.setSourcePort=function(e){if(d){var t=e.getAttachmentPoint().x-d.getAttachmentPoint().x,n=e.getAttachmentPoint().y-d.getAttachmentPoint().y,s=u.getSourceSegment();d.removeEdge(u),d=e,d.addEdgeOnInit(u),s&&(s.adjustStartPoint(t,n),s.adjustEndPoint(t,n))}else d=e,d.addEdgeOnInit(u);u.setName(u.getName())},u.getSourcePort=function(){return d};var S=void 0;u.setTargetPort=function(e){if(S){var t=e.getAttachmentPoint().x-S.getAttachmentPoint().x,n=e.getAttachmentPoint().y-S.getAttachmentPoint().y,s=u.getTargetSegment();S.removeEdge(u),S=e,S.addEdgeOnInit(u),s&&(s.adjustStartPoint(t,n),s.adjustEndPoint(t,n))}else S=e,S.addEdgeOnInit(u);u.setName(u.getName())},u.getTargetPort=function(){return S},u.getSourceNode=function(){return d?d.getNode():void 0},u.getTargetNode=function(){return S?S.getNode():void 0};var p,P;u.getSourceSide=function(){return p},u.setSourceSide=function(e){p=e},u.getTargetSide=function(){return P},u.setTargetSide=function(e){P=e},u.showSourceSymbol=!0,u.sourceIcon="",u.showTargetSymbol=!0,u.targetIcon="",u.thickness=1,u.setThickness=function(e){u.thickness=e},u.getThickness=function(){return u.thickness},u.setSourceShift=function(e){m=e},u.getSourceShift=function(){return m},u.setTargetShift=function(e){f=e},u.getTargetShift=function(){return f},u.setSrcPortOrder=function(e){c=e},u.getSrcPortOrder=function(){return c},u.setTrgPortOrder=function(e){h=e},u.getTrgPortOrder=function(){return h},u.setPipesOnly=function(e){l=e},u.hasPipesOnly=function(){return l},u.resetToDefaults=function(){m=s.portShift().NONE,f=s.portShift().NONE,l=!1};var v=[];u.getSegmentShifts=function(){return v},u.getSegmentShiftsToSave=function(){for(var e=r(),t=[],n=0;n<e.length;n++)0!=e[n].pipeShift&&t.push(e[n]);return t},u.setSegmentShifts=function(e){v=[];for(var t=0;t<e.length;t++){var n={};n.order=e[t].order,n.pipeShift=e[t].pipeShift,v.push(n)}},u.setSegmentShift=function(e,t){var n={};n.order=e,n.pipeShift=t,v.push(n)},u.getSegmentShift=function(e){for(var t=0;t<v.length;t++)if(v[t].order===e)return v[t].pipeShift;return 0},u.hasSegmentShifts=function(){return v.length>0},u.clearSegmentShifts=function(){v=[]},u.optimizationBlocked=!1,u.setOptimizationBlocked=function(e){u.optimizationBlocked=e},u.isOptimizationBlocked=function(){return u.optimizationBlocked},u.isDummyOptimization=function(){return!1};var E=[];u.addShortCut=function(e){E.push(e)},u.getShortCuts=function(){return E},u.isValid=function(){return d&&d.getNode()&&!d.getNode().isSuppressed()&&S&&S.getNode()&&!S.getNode().isSuppressed()},u.getOtherSidePort=function(e){return d.equals(e)?S:S.equals(e)?d:null},u.getLength=function(){for(var e=0,t=0;t<u.segments.length;t++)e+=u.segments[t].getLength();return e},u.getName=function(){return(d?"["+d.getNode().getName()+"/"+d.getName()+"]":"[null/null]")+"-"+(S?"["+S.getNode().getName()+"/"+S.getName()+"]":"[null/null]")},u.getSourceSegment=function(){for(var e=0;e<u.segments.length;e++)if(d.getAttachmentPoint().equals(u.segments[e].getStartPoint()))return u.segments[e];return null},u.getTargetSegment=function(){for(var e=0;e<u.segments.length;e++)if(S.getAttachmentPoint().equals(u.segments[e].getEndPoint()))return u.segments[e];return null},u.getStartSegment=function(){return u.segments.length>0?u.segments[0]:null},u.isStartSegment=function(e){return u.getStartSegment().equals(e)},u.getEndSegment=function(){return u.segments.length>0?u.segments[u.segments.length-1]:null},u.isEndSegment=function(e){return u.getEndSegment().equals(e)},u.isAllocated=function(){return!(!d||!d.getNode())&&(!(!S||!S.getNode())&&(d.getNode().isAllocated()&&S.getNode().isAllocated()))},u.contains=function(e){for(var t=0;t<u.segments.length;t++)if(u.segments[t].equals(e))return!0;return!1},u.getSegmentOrder=function(e){for(var t=0;t<u.segments.length;t++)if(u.segments[t].equals(e))return t;return-1},u.containsPoint=function(e){return g(e)},u.getSegmentAtPoint=function(e){return g(e)},u.addSegment=function(e){u.contains(e)||u.segments.push(e)},u.addSegmentAt=function(e,t){u.contains(t)||e>=0&&e<u.segments.length&&u.segments.splice(e,0,t)},u.replaceStartSegment=function(e){u.hasSegmentsChained||(u.segments.length>0?u.segments.splice(0,1,e):u.segments.push(e))},u.replaceEndSegment=function(e){if(!u.hasSegmentsChained)if(u.segments.length>0){var t=u.segments.length-1;u.segments[t];u.segments.splice(u.segments.length-1,1,e)}else u.segments.push(e)},u.updateEdgeLocations=function(){if(null!=u.getStartSegment()&&null!=u.getEndSegment())for(var e=u.getStartSegment().getStartPoint(),t=d.getAttachmentPoint(),n=e.x-t.x,s=e.y-t.y,r=0;r<u.segments.length;r++)0===r&&u.segments[r].adjustStartPoint(n,s),u.segments[r].adjustEndPoint(n,s)},u.updateEdgeLocationsOnDrag=function(){},u.adjustSegmentsLocations=function(){if(u.segments.length>0){var e=s.flow().UNDEF,t=u.getStartSegment();null!=t&&(e=t.getStartPoint().x===t.getEndPoint().x?s.flow().VERTICAL:s.flow().HORIZONTAL,t.getStartPoint().moveToPoint(d.getAttachmentPoint()),e==s.flow().VERTICAL?t.getEndPoint().moveToXY(d.getAttachmentPoint().x,t.getEndPoint().y):t.getEndPoint().moveToXY(t.getEndPoint().x,d.getAttachmentPoint().y));var n=u.getEndSegment();null!=n&&(e=n.getStartPoint().x===n.getEndPoint().x?s.flow().VERTICAL:s.flow().HORIZONTAL,n.getEndPoint().moveToPoint(S.getAttachmentPoint()),e==s.flow().VERTICAL?n.getStartPoint().moveToXY(S.getAttachmentPoint().x,n.getStartPoint().y):n.getStartPoint().moveToXY(n.getStartPoint().x,S.getAttachmentPoint().y));for(var r=1;r<u.segments.length-1;r++)null!=u.segments[r].getPipe()&&u.segments[r].getPipe().adjustSegment(u.segments[r])}},u.translateSegment=function(e,t,n){if(u.getStartSegment().equals(e)||u.getEndSegment().equals(e))console.log("ERROR: can't translate start or end segment");else{var s=u.getPreviousSegment(e),r=u.getNextSegment(e);s&&r?(e.adjustStartPoint(t,n),e.adjustEndPoint(t,n)):console.log("ERROR: can't locate previous or next to translate")}},u.clearSegments=function(){u.segments=[],u.hasSegmentsChained=!1},u.chainSegments=function(){if(u.hasSegmentsChained=!1,0===u.segments.length)return!1;var e=!1,t=[],n=u.segments.slice(),s=n[0].getEndPoint(),r=u.segments[0];for(t.push(r),n.splice(0,1);n.length>0;){var g=i(n,s);if(0===g.length){console.log("##### ERROR on chainSegments: no attached segments to point "+u.print()),e=!0;break}if(1===g.length){var m=g[0],f=o(n,m);t.push(m),s=m.getEndPoint(),n.splice(f,1)}else{var c=a(g),h=o(g,c),l=o(n,c);t.push(c),n.splice(l,1),g.splice(h,1),m=g[0],f=o(n,m),t.push(m),s=m.getEndPoint(),n.splice(f,1)}}return e||(u.segments=t,u.hasSegmentsChained=!0),u.hasSegmentsChained},u.getRectBounds=function(){var e=[];if(u.hasSegmentsChained)for(var n=0;n<u.segments.length;n++)0==n&&e.push(u.segments[n].self.getStartPoint()),e.push(u.segments[n].self.getEndPoint());if(0===e.length)return new t(0,0,0,0);for(var s=Number.MAX_VALUE,r=Number.MAX_VALUE,g=0,i=0,o=0;o<e.length;o++)s=Math.min(s,e[o].x),r=Math.min(r,e[o].y),g=Math.max(g,e[o].x),i=Math.max(i,e[o].y);return new t(s,r,g-s,i-r)},u.getAdjacentSegment=function(e,t){for(var n=0;n<u.segments.length;n++)if(u.segments[n].equals(e)){if(u.segments[n].getStartPoint().equals(t)&&n>0)return u.segments[n-1];if(u.segments[n].getEndPoint().equals(t)&&n<u.segments.length-1)return u.segments[n+1]}},u.getPreviousSegment=function(e){if(u.hasSegmentsChained)for(var t=0;t<u.segments.length;t++)if(u.segments[t].equals(e)&&t>0)return u.segments[t-1]},u.getNextSegment=function(e){if(u.hasSegmentsChained)for(var t=0;t<u.segments.length;t++)if(u.segments[t].equals(e)&&t<u.segments.length-1)return u.segments[t+1]},u.getSiblingSegments=function(e){var t=[];if(u.hasSegmentsChained)for(var n=0;n<u.segments.length;n++)u.segments[n].equals(e)&&(n>0&&t.push(u.segments[n-1]),n<u.segments.length-1&&t.push(u.segments[n+1]));return t},u.equals=function(e){return e&&e.getName()===u.getName()},u.print=function(){for(var e=u.getName()+", segments="+u.segments.length,t=0;t<u.segments.length;t++)e+="\n\t"+u.segments[t].print();return e},u.printEdge=function(){return u.getName()+", srcSide = "+u.getSourceSide()+", trgSide = "+u.getTargetSide()}}return r.inherit(g,e),g});