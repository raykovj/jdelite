define("modules/graph/pipe",["modules/geometry/rectangle","modules/graph/segmentChannel","modules/graph/graphConstants","modules/settings/config","modules/core/jsUtils"],function(e,n,t,a,s){function l(a){function s(e){for(var n=0;n<h.length;n++){if(h[n].getStartPoint().equals(e.getStartPoint())){h.splice(n,1);break}}h.push(e)}function r(e){for(var n=0;n<o.length;n++){if(o[n].getEndPoint().equals(e.getEndPoint())){o.splice(n,1);break}}o.push(e)}e.call(this,0,0,0,0);var g=this,h=[],o=[],c=[],i=[];g.getType=function(){return t.pipeType().UNDEF},g.order=a,g.getOrder=function(){return g.order},g.channels=[],g.getChannels=function(){return g.channels},g.clearChannels=function(){for(var e=0;e<g.channels.length;e++)g.channels[e].clear();g.channels=[],g.addNewChannel(new n)},g.clearSegmentsCache=function(){h=[],o=[],c=[],i=[]},g.addNewChannel=function(e){g.channels.push(e),e.setOrder(g.channels.length-1)},g.insertNewChannel=function(e){g.channels.splice(0,0,e);for(var n=0;n<g.channels.length;n++)g.channels[n].setOrder(n)},g.insertEmptyChannelAtIndex=function(e){if(e<g.channels.length){g.channels.splice(e,0,new n);for(var t=e;t<g.channels.length;t++)g.channels[t].setOrder(t)}else g.addNewChannel(new n)},g.incrementChannels=function(){var e=new n;return g.addNewChannel(e),e},g.hasEmptyChannels=function(){for(var e=0;e<g.channels.length;e++)if(0===g.channels[e].getSegments().length)return!0;return!1},g.auxChannelsNum=0,g.addAuxChannel=function(){g.hasEmptyChannels()||g.auxChannelsNum++},g.getSegmentChannel=function(e){for(var n=0;n<g.channels.length;n++)if(g.channels[n].contains(e))return g.channels[n]},g.removeSegmentFromPipe=function(e){var n=g.getSegmentChannel(e);n&&n.removeSegment(e)},g.addSegmentToPipe=function(e){var t=new n;t.addSegment(e),g.addNewChannel(t)},g.areSegmentsAllocated=!1,g.getAllSegments=function(){for(var e=[],n=0;n<g.channels.length;n++)e=e.concat(g.channels[n].getSegments());return e},g.getSegmentsNumber=function(){return g.getAllSegments().length},g.registerSegment=function(e){e.getType()===t.segmentType().NODE_TO_PIPE?s(e):e.getType()===t.segmentType().PIPE_TO_NODE?r(e):e.getType()===t.segmentType().IN_PIPE?c.push(e):e.getType()===t.segmentType().IN_CORRIDOR&&i.push(e)},g.getNode2PipeSegments=function(){return h},g.getPipe2NodeSegments=function(){return o},g.getNodeSegments=function(){return h.concat(o)},g.getInPipeSegments=function(){return c},g.getInCorridorSegments=function(){return i},g.getMinExtend=function(){return 0},g.getLayoutStep=function(){return t.segmentsGap().MIN+t.minSegmentSize().WIDTH},g.getStartChannelOffset=function(){var e=g.channels.length;if(e<=1)return 0;Math.floor(g.getLayoutStep()*(e-1)/2);return-Math.floor(g.getLayoutStep()*(e-1)/2)},g.getExtent=function(){},g.getExpand=function(){return 0},g.adjustSegment=function(e){},g.adjustGlobalSize=function(e){},g.adjustPipeExtend=function(){},g.assignSegmentsToChannels=function(){g.channels.length>1&&console.log("ERROR: orderSegment invoked second time");var e=require("modules/layout/layoutUtils");if(0===g.channels.length&&g.addNewChannel(new n),!(g.channels[0].getSegments().length<2)){for(var a=(g.getType()===t.pipeType().LEVEL_PIPE&&g.getOrder(),!0);a;){a=!1;var s=g.channels.length-1,l=g.channels[s];if(l.getSegments().length<2)break;for(var r=new n,h=0;h<l.getSegments().length-1;)for(var o=l.getSegments()[h++],c=l.segments.length-1;c>=0;c--){var i=l.segments[c];i.equals(o)||o.isSiblingWith(i)||e.areOverlapping(o,i)&&(a=!0,l.segments.splice(c,1),r.addSegment(i))}r.getSegments().length>0&&g.addNewChannel(r)}for(var u=0;u<g.auxChannelsNum;u++)u%2==0?g.addNewChannel(new n):g.insertNewChannel(new n)}},g.reassignSegmentsToChannels=function(){g.unassignChannels(),g.assignSegmentsToChannels()},g.unassignChannels=function(){g.deallocateSegments();var e=g.getAllSegments();g.clearChannels(),g.channels=[];var t=new n;t.addSegments(e),g.addNewChannel(t)},g.addSegment=function(e){if(!g.containsSegment(e)){0===g.channels.length&&g.addNewChannel(new n);g.channels[0].addSegment(e),e.setChannelIndex(0)}},g.containsSegment=function(e){var n=g.channels[0];if(null==n)return!1;for(var t=0;t<n.getSegments().length;t++){if(n.getSegments()[t].equals(e))return!0}return!1},g.hasSegment=function(e){for(var n=0;n<g.channels.length;n++)if(g.channels[n].contains(e))return!0;return!1},g.allocateSegments=function(){},g.deallocateSegments=function(){},g.swapSegments=function(e,n,t,a){},g.swapChannels=function(e,n){},g.moveSegment=function(e,n,t){},g.optimizePipe=function(){g.trimEmptyChannels(),g.mergeChannels(),g.trimEmptyChannels()},g.mergeChannels=function(){if(!(g.channels.length<=1)){var e,n,a,s,l=require("modules/layout/layoutUtils"),r=(g.getType()===t.pipeType().LEVEL_PIPE&&g.getOrder(),Math.floor(t.segmentsGap().MIN/2));for(e=0;e<g.channels.length-1;e++){var h=g.channels[e];for(n=e+1;n<g.channels.length;n++){var o=g.channels[n],c=o.getSegments();for(a=0;a<c.length;a++){var i=c[a];if(!l.hasSegmentConflictsInChanel(h,i,r))for(g.moveSegment(i,o,h),i.getEdge().adjustSegmentsLocations(),s=0;s<g.channels.length;s++){var u=5==e&&6==n,f=l.areSegment2ChannelCrossBox(i,g.channels[s],u),m=l.areSegment2ChannelSideBox(i,g.channels[s],u);if(f||m){g.moveSegment(i,h,o),i.getEdge().adjustSegmentsLocations();break}}}}}}},g.trimEmptyChannels=function(){var e=0,n=0;if(g.channels.length>1){for(n=0;n<g.channels.length&&0===g.channels[n].getSegments().length;n++)e++;if(e>0)for(g.channels.splice(0,e),n=0;n<g.channels.length;n++)g.channels[n].setOrder(g.channels[n].getOrder()-e)}if(g.channels.length>1)for(e=0,n=g.channels.length-1;n>=0&&0===g.channels[n].getSegments().length;n--)g.channels.splice(n,1),e++;if(g.channels.length>1)for(var t=-1;t<g.channels.length;){var a=0;for(t=-1,n=0;n<g.channels.length;n++)if(0===g.channels[n].getSegments().length){t=n;break}if(t>-1){for(n=t;n<g.channels.length&&0===g.channels[n].getSegments().length;n++)a++;if(a>0){for(n=t+a-1;n>=t;n--)g.channels.splice(n,1);for(n=t;n<g.channels.length;n++)g.channels[n].setOrder(n)}}else t=g.channels.length}1===g.channels.length&&0==g.channels[0].getSegments().length&&g.channels.splice(0,1)},g.optimizeSegmentsLength=function(){},g.getPipeAcceptingChannels=function(e,n){for(var t=[],a=require("modules/layout/layoutUtils"),s=0;s<g.channels.length;s++){var l=g.channels[s];if(l!==e){for(var r=!1,h=l.getSegments(),o=0;o<h.length;o++)if(a.areSegmentsProjectionsOverlapping(h[o],n,0)){r=!0;break}r||t.push(l)}}return t},g.equals=function(e){return e instanceof l&&g.getType()===e.getType()&&g.getOrder()===e.getOrder()},g.print=function(){for(var e=g.constructor.name+": order="+g.order+", type="+g.getType()+", channels: "+g.getChannels().length,n=0;n<g.getChannels().length;n++)e+="\n\t"+g.getChannels()[n].print();return e},g.printShort=function(){return g.constructor.name+": order="+g.order+", channels: "+g.getChannels().length+", "+g.showBounds()},g.printRect=function(){return"PIPE x = "+g.x+", y = "+g.y+", w = "+g.width+", h = "+g.height}}return s.inherit(l,e),l});