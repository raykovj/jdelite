define("modules/graph/levelPipe",["modules/graph/pipe","modules/graph/segmentChannel","modules/graph/graphConstants","modules/settings/config","modules/core/jsUtils"],function(e,t,n,o,g){function i(t){e.call(this,t);var g=this;g.getType=function(){return n.pipeType().LEVEL_PIPE},g.getLayoutStep=function(){return n.segmentsGap().MIN+n.minSegmentSize().WIDTH},g.getPipeFlowWidth=function(){var e=g.channels.length;return n.minSegmentSize().WIDTH+(e>1?g.getLayoutStep()*(e-1):0)},g.getExtent=function(){return g.getMinExtend()+g.getExpand()+g.getPipeFlowWidth()},g.adjustPipeExtend=function(){o.getFlowDirection()===n.flow().VERTICAL?g.setHeight(g.getExtent()):o.getFlowDirection()===n.flow().HORIZONTAL&&g.setWidth(g.getExtent())},g.adjustGlobalSize=function(e){o.getFlowDirection()===n.flow().VERTICAL?g.setRectSize(e,g.getExtent()):o.getFlowDirection()===n.flow().HORIZONTAL&&g.setRectSize(g.getExtent(),e)},g.adjustSegment=function(e){var t=g.getLayoutStep(),i=g.getStartChannelOffset(),a=e.getChannelIndex(),r=i+a*t,l=0,s=0,d=0,f=0;o.getFlowDirection()===n.flow().VERTICAL?(s=g.y+Math.floor(g.height/2),f=s+r,e.getStartPoint().moveToXY(e.getStartPoint().x,f),e.getEndPoint().moveToXY(e.getEndPoint().x,f)):o.getFlowDirection()===n.flow().HORIZONTAL&&(l=g.x+Math.floor(g.width/2),d=l+r,e.getStartPoint().moveToXY(d,e.getStartPoint().y),e.getEndPoint().moveToXY(d,e.getEndPoint().y))},g.getMinExtend=function(){if(0===g.channels.length)return n.emptyPipeSize().WIDTH;if(1===g.channels.length){for(var e,t=g.channels[0].getSegments(),i=0;i<t.length;i++)if(t[i].getLength()>0){e=!0;break}if(!e)return n.emptyPipeSize().WIDTH}return o.getFlowDirection()===n.flow().HORIZONTAL?2*n.edgeOffsetLimit().VERTICAL:2*n.edgeOffsetLimit().HORIZONTAL},g.getExpand=function(){return o.getAlongPipeExpand()},g.allocateSegments=function(){if(!g.areSegmentsAllocated){if(g.channels.length>1)for(var e=g.getLayoutStep(),t=g.getStartChannelOffset(),i=0;i<g.channels.length;i++){var a=g.channels[i];a.setOrder(i);for(var r=0;r<a.getSegments().length;r++){var l=a.getSegments()[r];o.getFlowDirection()===n.flow().HORIZONTAL?(l.adjustStartPoint(t+i*e,0),l.adjustEndPoint(t+i*e,0)):o.getFlowDirection()===n.flow().VERTICAL&&(l.adjustStartPoint(0,t+i*e),l.adjustEndPoint(0,t+i*e)),l.setChannelIndex(i)}}g.areSegmentsAllocated=!0}},g.deallocateSegments=function(){if(g.areSegmentsAllocated){if(g.channels.length>1)for(var e=g.getLayoutStep(),t=g.getStartChannelOffset(),i=0;i<g.channels.length;i++)for(var a=g.channels[i],r=0;r<a.getSegments().length;r++){var l=a.getSegments()[r];o.getFlowDirection()===n.flow().HORIZONTAL?(l.adjustStartPoint(-t-i*e,0),l.adjustEndPoint(-t-i*e,0)):o.getFlowDirection()===n.flow().VERTICAL&&(l.adjustStartPoint(0,-t-i*e),l.adjustEndPoint(0,-t-i*e)),l.setChannelIndex(0)}g.areSegmentsAllocated=!1}},g.swapSegments=function(e,t,i,a){var r=(i.getOrder()-e.getOrder())*g.getLayoutStep();e.removeSegment(t),i.removeSegment(a),o.getFlowDirection()===n.flow().HORIZONTAL?(t.getEdge().translateSegment(t,r,0),a.getEdge().translateSegment(a,-r,0)):o.getFlowDirection()===n.flow().VERTICAL&&(t.getEdge().translateSegment(t,0,r),a.getEdge().translateSegment(a,0,-r)),e.addSegment(a),i.addSegment(t)},g.swapChannels=function(e,t){var i=(t.getOrder()-e.getOrder())*g.getLayoutStep(),a=e.getSegments().slice(0),r=t.getSegments().slice(0),l=0,s=0;if(e.clear(),t.clear(),o.getFlowDirection()===n.flow().HORIZONTAL){for(l=0;l<a.length;l++)a[l].adjustStartPoint(i,0),a[l].adjustEndPoint(i,0);for(s=0;s<r.length;s++)r[s].adjustStartPoint(-i,0),r[s].adjustEndPoint(-i,0)}else if(o.getFlowDirection()===n.flow().VERTICAL){for(l=0;l<a.length;l++)a[l].adjustStartPoint(0,i),a[l].adjustEndPoint(0,i);for(s=0;s<r.length;s++)r[s].adjustStartPoint(0,-i),r[s].adjustEndPoint(0,-i)}e.addSegments(r),t.addSegments(a)},g.moveSegment=function(e,t,i){if(t&&i){var a=(i.getOrder()-t.getOrder())*g.getLayoutStep();t.removeSegment(e),o.getFlowDirection()===n.flow().HORIZONTAL?e.getEdge().translateSegment(e,a,0):o.getFlowDirection()===n.flow().VERTICAL&&e.getEdge().translateSegment(e,0,a),i.addSegment(e)}else console.log("#????? LEVEL ??????? ERROR moveSegment, fromChannel: "+t+", toChannel: "+i)}}return g.inherit(i,e),i});