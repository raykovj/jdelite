define("modules/layout/nodesLayout",["modules/geometry/point","modules/graph/xPoint","modules/graph/cell","modules/graph/nodeCell","modules/graph/graphNode","modules/graph/graphPort","modules/graph/connector","modules/graph/level","modules/graph/levelPipe","modules/graph/lane","modules/graph/lanePipe","modules/layout/nodesLayoutUtils","modules/layout/nodesCollector","modules/common/utils","modules/graph/segment","modules/graph/graphConstants","modules/settings/config"],function(e,t,s,n,a,l,g,o,r,L,i,d,h,v,u,N,f){function c(e){function t(e,t){if(s()){var n=f.hasSideSwimLanes()?g.getLanes().length-2:g.getLanes().length;if(!(n<=t)){var a,o,r=n-t,L=d.getLeftLaneNodes(e),i=d.getRightLaneNodes(e),h=v.subtractArrays(e,L);h=v.subtractArrays(h,i);var u=f.hasSideSwimLanes()?1:0,N=d.getMinLaneIndex(h),c=d.getMaxLaneIndex(h),p=d.getEmptyLanesNumber(g.getLanes(),N,c);if(N-u>0)for(o=g.getLanes(),a=o.length-1;a>=0;a--){var m=o[a];m.getOrder()>=u&&0==m.getNodes().length&&m.getOrder()<N&&r>0&&(o.splice(a,1),r--)}if(l.readjustLanesOrders(),N=d.getMinLaneIndex(h),c=d.getMaxLaneIndex(h),p>0){var C=d.getFirstEmptyLaneIndex(g.getLanes(),N,c);for(o=g.getLanes(),a=o.length-1;a>=0;a--)m=o[a],m.getOrder()<C||0===m.getNodes().length&&m.getOrder()<c&&r>0&&(o.splice(a,1),r--);l.readjustLanesOrders()}c=d.getMaxLaneIndex(h);var S=f.hasSideSwimLanes()?g.getLanes().length-2:g.getLanes().length-1;if(c<S){for(o=g.getLanes(),a=o.length-1;a>=0;a--)m=o[a],m.getOrder()<=c||0===m.getNodes().length&&m.getOrder()<=S&&r>0&&(o.splice(a,1),r--);l.readjustLanesOrders()}}}}function s(){return(f.hasSideSwimLanes()?g.getLanes().length-2:g.getLanes().length)>=N.lanesRange().MIN}var l=this,g=e;l.initialize=function(){},l.adjustGraphNodesLocations=function(){var e,t=g.getNodesList();if(f.getLayoutMode()==N.layoutMode().MANUAL){var s,n,l=d.getLeftLaneNodes(t),o=d.getRightLaneNodes(t),r=v.subtractArrays(t,l);r=v.subtractArrays(r,o);var L=d.getNodesLaneRange(r),i=d.getNodesLaneRange(o),h=L[0],u=L[1];if(r.length>0&&(console.log("################ NODE [0]: level: "+r[0].getLevelNumber()+", lane: "+r[0].getLevelNumber()),console.log("################ RANGE: 0: "+L[0]+", 1: "+L[1])),f.hasSideSwimLanes()){if(n=0,f.hasExtraFirstLane()?(0==h?n=2:1==h?n=1:h>2&&(n=-(h-2)),s="has side swim lanes, has extra first lane, shift = "+Math.abs(n)):(0==h?n=1:h>1&&(n=-(h-1)),s="has side swim lanes, no extra first lane, shift = "+Math.abs(n)),0!=n&&(r.length>0||o.length>0)){for(e=0;e<r.length;e++)r[e].getLaneNumber()!=a.LANE_UNDEF&&r[e].setLaneNumber(r[e].getLaneNumber()+n);for(e=0;e<o.length;e++)o[e].getLaneNumber()!=a.LANE_UNDEF&&o[e].setLaneNumber(o[e].getLaneNumber()+n);console.log(s)}if(o.length>0){n=0;var c=i[0],p=c-u;if(f.hasExtraLastLane()?(2!=p&&(n=u+2-c),s="has side swim lanes, has extra last lane, shift = "+Math.abs(n)):(1!=p&&(n=u+1-c),s="has side swim lanes, no extra last lane, shift = "+Math.abs(n)),0!=n){for(e=0;e<o.length;e++)o[e].getLaneNumber()!=a.LANE_UNDEF&&o[e].setLaneNumber(o[e].getLaneNumber()+n);console.log(s)}}for(e=0;e<l.length;e++)l[e].setSuppressed(!1);for(e=0;e<o.length;e++)o[e].setSuppressed(!1)}else{if(n=0,f.hasExtraFirstLane()?(h>1?n=h-1:0==h&&(n=-1),s="no side swim lanes, has extra first lane, shift = "+Math.abs(n)):(h>0&&(n=h),s="no side swim lanes, no extra first lane, shift = "+Math.abs(n)),0!=n&&r.length>0)for(e=0;e<r.length;e++)r[e].getLaneNumber()!=a.LANE_UNDEF&&r[e].setLaneNumber(r[e].getLaneNumber()-n);for(console.log(s),e=0;e<l.length;e++)l[e].setSuppressed(!0);for(e=0;e<o.length;e++)o[e].setSuppressed(!0)}var m=d.getStartNodes(t),C=d.getEndNodes(t);r=v.subtractArrays(t,m),r=v.subtractArrays(r,C);var S=d.getNodesLevelRange(r),w=d.getNodesLevelRange(C),T=S[0],E=S[1];if(f.hasStartEndLevels()){if(n=0,f.hasExtraFirstLevel()?(0==T?n=2:1==T?n=1:T>2&&(n=-(T-2)),s="has start/end levels, has extra first level, shift = "+Math.abs(n)):(0==T?n=1:T>1&&(n=-(T-1)),s="has start/end levels, no extra first level, shift = "+Math.abs(n)),0!=n&&(r.length>0||C.length>0)){for(e=0;e<r.length;e++)r[e].getLevelNumber()!=a.LEVEL_UNDEF&&r[e].setLevelNumber(r[e].getLevelNumber()+n);for(e=0;e<C.length;e++)C[e].getLevelNumber()!=a.LEVEL_UNDEF&&C[e].setLevelNumber(C[e].getLevelNumber()+n);console.log(s)}if(C.length>0){n=0;var A=w[0],b=A-E;if(f.hasExtraLastLevel()?(2!=b&&(n=E+2-A),s="has start/end levels, has extra last level, shift = "+Math.abs(n)):(1!=b&&(n=E+1-A),s="has start/end levels, no extra last level, shift = "+Math.abs(n)),0!=n){for(e=0;e<C.length;e++)C[e].getLevelNumber()!=a.LEVEL_UNDEF&&C[e].setLevelNumber(C[e].getLevelNumber()+n);console.log(s)}}for(e=0;e<m.length;e++)m[e].setSuppressed(!1);for(e=0;e<C.length;e++)C[e].setSuppressed(!1)}else{if(n=0,f.hasExtraFirstLevel()?(T>1?n=T-1:0==T&&(n=-1),s="no start/end levels, has extra first level, shift = "+Math.abs(n)):(T>0&&(n=T),s="no start/end levels, no extra first level, shift = "+Math.abs(n)),0!=n&&r.length>0)for(e=0;e<r.length;e++)r[e].getLevelNumber()!=a.LEVEL_UNDEF&&r[e].setLevelNumber(r[e].getLevelNumber()-n);for(console.log(s),e=0;e<m.length;e++)m[e].setSuppressed(!0);for(e=0;e<C.length;e++)C[e].setSuppressed(!0)}}else{var y=!f.hasSideSwimLanes(),x=d.getLeftLaneNodes(t);for(x=x.concat(d.getRightLaneNodes(t)),e=0;e<x.length;e++)x[e].setSuppressed(y);var M=!f.hasStartEndLevels(),O=d.getStartNodes(t);for(O=O.concat(d.getEndNodes(t)),e=0;e<O.length;e++)O[e].setSuppressed(M)}},l.adjustNodesInCanvas=function(){var e,t=g.getNodesList(),s=d.getLeftLaneNodes(t),n=d.getRightLaneNodes(t);if(f.hasSideSwimLanes()){for(e=0;e<s.length;e++)s[e].setSuppressed(!1);for(e=0;e<n.length;e++)n[e].setSuppressed(!1)}else{for(e=0;e<s.length;e++)s[e].setSuppressed(!0);for(e=0;e<n.length;e++)n[e].setSuppressed(!0)}var a=d.getStartNodes(t),l=d.getEndNodes(t);if(f.hasStartEndLevels()){for(e=0;e<a.length;e++)a[e].setSuppressed(!1);for(e=0;e<l.length;e++)l[e].setSuppressed(!1)}else{for(e=0;e<a.length;e++)a[e].setSuppressed(!0);for(e=0;e<l.length;e++)l[e].setSuppressed(!0)}},l.createNewCellToLevel=function(e,t){var s=g.getNodeToCellMap().get(e.getName());if(s){e.getName();return s}var a=new n(e);return g.getNodeToCellMap().put(e.getName(),a),t.addCell(a),a},l.reassignCellToLevel=function(e,t){var s=g.getNodeToCellMap().get(e.getName());if(!s)return void console.log("Cell cannot be found for level reallocation");g.getLevels()[e.getLevelNumber()].removeCell(s),t.addCell(s)},l.reassignCellToLane=function(e,t){var s=g.getNodeToCellMap().get(e.getName());if(!s)return void console.log("Cell cannot be found for lane reallocation");g.getLanes()[e.getLaneNumber()].removeCell(s),t.addCell(s)},l.attemptToAssignToLevel=function(e,t){return!g.getNodeToCellMap().get(e.getName())&&(l.createNewCellToLevel(e,t),!0)},l.layoutNodesManual=function(){l.assignNodesToLevelsManual(),l.assignNodesToLanesManual()},l.assignNodesToLevelsManual=function(){var e,t,s,n,a=f.getCanvasLevels(),r=g.getNonSuppressedNodes(),L=d.getStartNodes(r),i=d.getEndNodes(r),h=v.subtractArrays(r,L);if(h=v.subtractArrays(h,i),f.hasStartEndLevels())for(s=new o(0),s.setStartLevel(!0),g.getLevels().push(s),e=0;e<L.length;e++)l.createNewCellToLevel(L[e],s);else if(L.length>0){for(s=new o(0),e=0;e<L.length;e++)l.createNewCellToLevel(L[e],s);g.getLevels().push(s)}var u=d.getNodesLevelRange(h),N=(u[0],u[1]),c=g.getLevels().length;if(0===h.length)for(e=0;e<a;e++)t=new o(c++),g.getLevels().push(t);else{for(var p=g.getLevels().length;p<=N;p++){t=new o(c++),g.getLevels().push(t);var m=d.getNodesAtLevel(h,p);for(e=0;e<m.length;e++)l.createNewCellToLevel(m[e],t);h=v.subtractArrays(h,m)}f.hasExtraLastLevel()&&(t=new o(c++),g.getLevels().push(t));var C=d.getCentralLevelsNumber(g.getLevels());if(C<a)for(e=C;e<a;e++)t=new o(c++),g.getLevels().push(t)}if(f.hasStartEndLevels())for(n=new o(c),n.setEndLevel(!0),g.getLevels().push(n),e=0;e<i.length;e++)l.createNewCellToLevel(i[e],n);else if(i.length>0){for(n=new o(c),e=0;e<i.length;e++)l.createNewCellToLevel(i[e],n);g.getLevels().push(n)}},l.assignNodesToLanesManual=function(){var e,t,s,n=f.getCanvasLanes(),a=g.getNonSuppressedNodes(),l=d.getLeftLaneNodes(a),o=d.getRightLaneNodes(a),r=v.subtractArrays(a,l);r=v.subtractArrays(r,o);var i=d.getNodesLaneRange(r);if(f.hasSideSwimLanes()){var h=new L(0);for(h.setLeftLane(!0),g.getLanes().push(h),e=0;e<l.length;e++)l[e].setLaneNumber(0),s=g.getNodeToCellMap().get(l[e].getName()),s?h.addCell(s):console.log("ERROR: No cell assigned for node: "+l[e].getName())}var u=g.getLanes().length,N=i[1];if(0===r.length)for(e=0;e<n;e++)t=new L(u++),g.getLanes().push(t);else{for(var c=g.getLanes().length;c<=N;c++){t=new L(u++),g.getLanes().push(t);var p=d.getNodesAtLane(r,c);for(e=0;e<p.length;e++)(s=g.getNodeToCellMap().get(p[e].getName()))&&t.addCell(s);r=v.subtractArrays(r,p)}f.hasExtraLastLane()&&(t=new L(u++),g.getLanes().push(t));var m=d.getCentralLanesNumber(g.getLanes());if(m<n)for(e=m;e<n;e++)t=new L(u++),g.getLanes().push(t)}if(f.hasSideSwimLanes()){var C=new L(u);for(C.setRightLane(!0),g.getLanes().push(C),e=0;e<o.length;e++)o[e].setLaneNumber(u),(s=g.getNodeToCellMap().get(o[e].getName()))&&C.addCell(s)}},l.layoutNodesAutoLayout=function(){l.assignNodesToLevelsAutoLayout();var e=l.getLevelUnallocatedNodes();return 0===e.length?(l.assignNewLanesAutoLayout(),!0):(r(e),!1)},l.getLevelUnallocatedNodes=function(){for(var e=[],t=g.getNonSuppressedNodes(),s=0;s<t.length;s++){var n=t[s];n.isLevelAssigned()||e.push(n)}return e};var r=function(e){for(var t=0;t<e.length;t++)console.log("???? layoutNodesAutoLayout: node level not assigned: "+e[t].getName())};l.printCells=function(e){console.log("@@ print cells: "+e);for(var t=g.getNodeToCellMap().values(),s=0;s<t.length;s++)console.log(" -- "+t[s].print())},l.assignNodesToLevelsAutoLayout=function(){var e,t=g.getNodesCollector(),s=t.getStartNodes();if(f.hasStartEndLevels()){var n=new o(0);for(n.setStartLevel(!0),g.getLevels().push(n),e=0;e<s.length;e++)l.createNewCellToLevel(s[e],n)}var a=[];a=a.concat(s);var r=t.getFirstLevelCandidates();if(0!=r.length)for(var L=l.assignNodesToFirstLevelsAutoLayout(r);L.length>0;)a=a.concat(L),L=l.assignNodesToNextLevelAutoLayout(a);var i=g.getLevels().length;if(l.assignUnconnectedNodesToLevelsAutoLayout(i),0==v.subtractArrays(g.getNonSuppressedNodes(),s).length){var d=new o(g.getLevels().length);g.getLevels().push(d)}var h=t.getEndNodes();if(f.hasStartEndLevels()){var u=new o(g.getLevels().length);for(u.setEndLevel(!0),g.getLevels().push(u),e=0;e<h.length;e++)l.createNewCellToLevel(h[e],u)}},l.assignNodesToFirstLevelsAutoLayout=function(e){var t,s,n,a,r=g.getNodesCollector(),L=g.getLevels().length,i=e.slice(0),d=[],h=r.getLeftTopNodes().slice(0),v=r.getStartNodesLeftTargets();if(v.length>0)for(t=0;t<v.length;t++)s=v[t],a=new o(g.getLevels().length),l.createNewCellToLevel(s,a),d.push(s),n=i.indexOf(s),i.splice(n,1),n=h.indexOf(s),h.splice(n,1),g.getLevels().push(a);var u=0===h.length?[]:r.getConnectedSources(h,e);if(u=u.concat(r.getLeftNoInputNodes()),u.length>0)for(t=0;t<u.length;t++)s=u[t],a=new o(g.getLevels().length),l.createNewCellToLevel(s,a),d.push(s),n=i.indexOf(s),i.splice(n,1),n=h.indexOf(s),h.splice(n,1),g.getLevels().push(a);var N=r.getRightBottomNodes().slice(0),f=L,c=r.getStartNodesRightTargets();if(c.length>0)for(t=0;t<c.length;t++)s=c[t],f<g.getLevels().length?(a=g.getLevels()[f],l.createNewCellToLevel(s,a),d.push(s),n=i.indexOf(s),i.splice(n,1)):(a=new o(g.getLevels().length),l.createNewCellToLevel(s,a),d.push(s),n=i.indexOf(s),i.splice(n,1),g.getLevels().push(a)),f++,n=N.indexOf(s),N.splice(n,1);var p=0===N.length?[]:r.getConnectedSources(N,e);if(p=p.concat(r.getRightNoInputNodes()),p.length>0)for(t=0;t<p.length;t++)s=p[t],f<g.getLevels().length?(a=g.getLevels()[f],l.createNewCellToLevel(s,a),d.push(s),n=i.indexOf(s),i.splice(n,1)):(a=new o(g.getLevels().length),l.createNewCellToLevel(s,a),d.push(s),n=i.indexOf(s),i.splice(n,1),g.getLevels().push(a)),f++,n=N.indexOf(s),N.splice(n,1);if(i.length>0){for(a=L<g.getLevels().length?g.getLevels()[L]:new o(L),t=i.length-1;t>=0;t--)s=i[t],l.createNewCellToLevel(s,a),d.push(s),i.splice(t,1);L===g.getLevels().length&&g.getLevels().push(a)}if(i.length>0){var m=l.assignDecisionNodesToLevelsAutoLayout(d,i,L);d=d.concat(m)}return d},l.assignNodesToNextLevelAutoLayout=function(e){var t,s=g.getNodesCollector(),n=g.getLevels().length,r=d.getFirstCenterEmptyLevelIndex(g.getLevels());r===a.LEVEL_UNDEF&&(r=n);var L=[],i=[];for(t=0;t<e.length;t++)i=i.concat(d.getCentralTargets(e[t],i));var h=s.getConnectedSources(s.getLeftTopNodes(),i),u=s.getConnectedSources(s.getRightBottomNodes(),i),N=l.assignSideNodesToLevelsAutoLayout(h,u,n);L=L.concat(N);var f=d.getNodesAtLevel(N,n);for(t=0;t<f.length;t++)i=i.concat(d.getCentralTargets(f[t],i));var c=d.getLeftLaneNodes(i),p=d.getRightLaneNodes(i),m=l.assignSideNodesToLevelsAutoLayout(c,p,n);if(L=v.mergeArrays(L,m),i=v.subtractArrays(i,c),i=v.subtractArrays(i,p),i.length>0){var C,S;if(r<g.getLevels().length){S=g.getLevels()[r];var w=S.getNodes().slice(0);for(w=v.mergeArrays(w,i),t=0;t<i.length;t++)C=i[t],C.isLevelAssigned()||(d.isNodeTargetOf(C,w),l.createNewCellToLevel(C,S),L.push(C))}else{for(S=new o(g.getLevels().length),t=0;t<i.length;t++)C=i[t],C.isLevelAssigned()||(l.createNewCellToLevel(C,S),L.push(C));S.getNodes().length>0&&g.getLevels().push(S)}}return L},l.assignDecisionNodesToLevelsAutoLayout=function(e,t,s){var n,r,L,i,h,v,u=d.getLeftLaneNodes(e),N=d.getRightLaneNodes(e),f=[],c=d.getDecisionNodes(t);for(n=0;n<c.length;n++)if(L=c[n],h=d.getConnectedNodes(u,L),v=d.getConnectedNodes(N,L),h.length>0){var p=h[0];r=p.getLevelNumber(),r>a.LEVEL_UNDEF&&(i=g.getLevels()[r],l.createNewCellToLevel(L,i),f.push(L))}else if(v.length>0){var m=v[0];r=m.getLevelNumber(),r>a.LEVEL_UNDEF&&(i=g.getLevels()[r],l.createNewCellToLevel(L,i),f.push(L))}for(n=0;n<c.length;n++)L=c[n],L.isLevelAssigned()||(h=d.getConnectedNodes(u,L),v=d.getConnectedNodes(N,L),0===h.length&&0===v.length&&(i=new o(g.getLevels().length),l.createNewCellToLevel(L,i),f.push(L),g.getLevels().push(i)));return f},l.assignSideNodesToLevelsAutoLayout=function(e,t,s){var n,a,r,L=[],i=s;for(n=0;n<e.length;n++)a=e[n],a.isLevelAssigned()||(i<g.getLevels().length?(r=g.getLevels()[i],l.createNewCellToLevel(a,r),L.push(a),i++):(r=new o(g.getLevels().length),l.createNewCellToLevel(a,r),L.push(a),g.getLevels().push(r),i++));for(i=s,n=0;n<t.length;n++)a=t[n],a.isLevelAssigned()||(i<g.getLevels().length?(r=g.getLevels()[i],l.createNewCellToLevel(a,r),L.push(a),i++):(r=new o(g.getLevels().length),l.createNewCellToLevel(a,r),L.push(a),g.getLevels().push(r),i++));return L},l.assignUnconnectedNodesToLevelsAutoLayout=function(e){var t=g.getNodesCollector(),s=t.getCenterNoCnxNodes();if(s.length>0){for(var n=new o(e),a=0;a<s.length;a++)l.createNewCellToLevel(s[a],n);g.getLevels().push(n)}var r=t.getLeftTopNoCnxNodes(),L=t.getRightBottomNoCnxNodes();l.assignSideNodesToLevelsAutoLayout(r,L,e)},l.getUnconnectedNodesSquareSize=function(e){return Math.ceil(Math.sqrt(e.length))},l.assignNewLanesAutoLayout=function(){if(0===g.getLevels().length)return void console.log("WARNING: assignNewLanesAutoLayout - NO LEVELS");var e,s,n,a=g.getNodesCollector(),r=f.hasSideSwimLanes(),i=f.hasStartEndLevels(),h=1,u=a.getEndNodes().length+(r?2:0),N=a.getCenterNoCnxNodes(),c=a.getLeftTopNoCnxNodes(),p=a.getRightBottomNoCnxNodes(),m=v.subtractArrays(g.getNonSuppressedNodes(),N);m=v.subtractArrays(m,c),m=v.subtractArrays(m,p);var C=l.getUnconnectedNodesSquareSize(N),S=Math.max(a.getEndNodes().length,C);for(h+=i?d.getDescendantsTreeWidthByLevel(g.getLevels()[0])+d.getDescendantsTreeWidthByLevel(g.getLevels()[1]):d.getDescendantsTreeWidthByLevel(g.getLevels()[0]),h+=d.getDescendantsTreeWidth(a.getLeftTopNodes()),h+=d.getDescendantsTreeWidth(a.getRightBottomNodes()),h=Math.max(h,C),h=Math.max(h,u),h+=r?2:0,e=0;e<h;e++){var w=new L(e);g.getLanes().push(w)}f.hasSideSwimLanes()&&(g.getLanes()[0].setLeftLane(!0),g.getLanes()[g.getLanes().length-1].setRightLane(!0));var T=i&&g.getLevels()[0].getNodes().length>0;T&&l.assignLanesForLevelAutoLayout(g.getLevels()[0],r,!0);var E=d.getStartNodes(g.getNonSuppressedNodes());m=v.subtractArrays(m,E);var A=i?1:0,b=A,y=i?g.getLevels().length-2:g.getLevels().length-1,x=!1;if(m.length>0){if(d.hasAssignedLevels(g.getLevels())){for(;g.getLevels().length>A&&0===g.getLevels()[A].getCells().length;)A++;var M=g.getLevels()[A];l.assignLanesForLevelAutoLayout(M,r,!T),b++;var O=g.getLevels();for(e=0;e<O.length;e++)if(s=O[e],s.getOrder()>A&&s.getOrder()<=y){if(d.areAllUnconnected(s.getNodes()))break;l.assignLanesForLevelAutoLayout(s,r,!1),b++}}var F=m.slice(0);F=v.subtractArrays(F,a.getEndNodes()),t(F,S),i&&(n=g.getLevels()[g.getLevels().length-1],l.assignLanesForEndLevelAutoLayout(n,!0,r),l.assignLanesForEndLevelAutoLayout(n,!1,r),x=!0)}if(N.length>0||c.length>0||p.length>0){var R=l.getCurrentLaneRange(0)+1,D=Math.max(R,l.getUnconnectedNodesSquareSize(N)),U=b;for(y=i?g.getLevels().length-2:g.getLevels().length-1,e=0;e<N.length;){for(var I=U<=y?g.getLevels()[U]:new o(U),P=0;P<D&&e<N.length;){if(U!=b){var _=N[e];l.reassignCellToLevel(_,I)}e++,P++}U>y&&g.getLevels().splice(U,0,I),U++}y=i?g.getLevels().length-2:g.getLevels().length-1;for(var B=b;B<=y;B++)s=g.getLevels()[B],l.assignLanesForLevelAutoLayout(s,r,!1);if(i&&b<y){n=g.getLevels()[g.getLevels().length-1],n.setOrder(U);var V=n.getNodes();for(e=0;e<V.length;e++)l.reassignCellToLevel(V[e],n)}}if(i&&!x){var W=g.getLevels().length-1,j=g.getLevels()[W];l.assignLanesForLevelAutoLayout(j,r,!1)}l.removeEmptyLanes()},l.getCurrentLaneRange=function(e){var t=d.getFirstNonEmptyCentralLaneIndex(g.getLanes()),s=d.getLastNonEmptyCentralLaneIndex(g.getLanes()),n=s-t;return Math.max(n,e)},l.assignLanesForLevelAutoLayout=function(e,t,s){var n,l,o,r,L,i,h=e.getNodes().slice(0),v=e.getLeftLaneNode(),u=e.getRightLaneNode();if(v&&(r=g.getNodeToCellMap().get(v.getName()))&&(g.getLanes()[0].addCell(r),L=h.indexOf(v),h.splice(L,1)),u&&(r=g.getNodeToCellMap().get(u.getName()))&&(g.getLanes()[g.getLanes().length-1].addCell(r),o=h.indexOf(u),h.splice(o,1)),0!==h.length){var N=t?1:0,c=t?g.getLanes().length-2:g.getLanes().length-1;if(s){var p=N;for(n=0;n<h.length;n++){l=h[n];var m=l.getLaneFootprint();p+Math.floor(m/2)>c||(r=g.getNodeToCellMap().get(l.getName()),r&&g.getLanes()[p+Math.floor(m/2)].addCell(r),p+=m)}}else{var C=h.slice(0);for(n=C.length-1;n>=0;n--){l=C[n];var S=d.getDecisionParent(l);if(S){if(!S.isAllocated())continue;var w=d.getDecisionChildPosition(S,l,f.getFlowDirection());if((i=d.getNewLanePosition(e,w,N,c))===a.LANE_UNDEF){C.splice(n,1);continue}r=g.getNodeToCellMap().get(l.getName()),r&&g.getLanes()[i].addCell(r),C.splice(n,1)}}for(n=C.length-1;n>=0;n--){l=C[n];var T=d.getSourceNodes(l);if(T.length>0){var E=d.getAverageLanePosition(T);if((i=d.getNewLanePosition(e,E,N,c))===a.LANE_UNDEF){C.splice(n,1);continue}r=g.getNodeToCellMap().get(l.getName()),r&&g.getLanes()[i].addCell(r),C.splice(n,1)}}if(C.length>0)for(n=0;n<C.length;n++)l=C[n],(i=d.getNextLanePositionInLevel(e,l,N,c))>=0&&i<g.getLanes().length&&(r=g.getNodeToCellMap().get(l.getName()))&&g.getLanes()[i].addCell(r)}}},l.assignLanesForEndLevelAutoLayout=function(e,t,s){var n=e.getNodes();if(0!==n.length){var l,o,r,L,i,h=s?1:0,v=s?g.getLanes().length-2:g.getLanes().length-1;if(t){for(o=d.getNodesWithConnections(n),l=o.length-1;l>=0;l--){r=o[l];var u=d.getDecisionParent(r);if(u){var N=d.getDecisionChildPosition(u,r,f.getFlowDirection());if((i=d.getNewLanePosition(e,N,h,v))===a.LANE_UNDEF){o.splice(l,1);continue}L=g.getNodeToCellMap().get(r.getName()),L&&g.getLanes()[i].addCell(L),o.splice(l,1)}}for(l=o.length-1;l>=0;l--){r=o[l];var c=d.getSourceNodes(r);if(c.length>0){var p=d.getAverageLanePosition(c);if((i=d.getNewLanePosition(e,p,h,v))===a.LANE_UNDEF){o.splice(l,1);continue}L=g.getNodeToCellMap().get(r.getName()),L&&g.getLanes()[i].addCell(L),o.splice(l,1)}}}else for(o=d.getUnconnectedNodes(n),l=0;l<o.length;l++)r=o[l],(i=d.getNextLanePositionInLevel(e,r,h,v))>=0&&i<g.getLanes().length&&(L=g.getNodeToCellMap().get(r.getName()))&&g.getLanes()[i].addCell(L)}},l.readjustLanesOrders=function(){for(var e=0;e<g.getLanes().length;e++){var t=g.getLanes()[e];if(t.getOrder()!=e){t.setOrder(e);for(var s=t.getNodes(),n=0;n<s.length;n++)s[n].setLaneNumber(t.getOrder())}}},l.removeEmptyLanes=function(){if(s()){var e,t,n,a,l=d.getLeftLaneNodes(g.getNonSuppressedNodes()),o=d.getRightLaneNodes(g.getNonSuppressedNodes()),r=v.subtractArrays(g.getNonSuppressedNodes(),l);r=v.subtractArrays(r,o);var L=d.getMinLaneIndex(r),i=f.hasSideSwimLanes()?1:0,h=L-i;if(h>0)for(t=g.getLanes(),e=t.length-1;e>=0;e--)if(n=t[e],n.getOrder()>=i&&n.getOrder()<L)t.splice(e,1);else if(n.getOrder()>=L)for(n.setOrder(n.getOrder()-h),a=n.getNodes(),e=0;e<a.length;e++)a[e].setLaneNumber(n.getOrder());if(s()){for(var u=d.getMaxLaneIndex(r),N=d.getFirstEmptyLaneIndex(g.getLanes(),i,u);N>i;){for(t=g.getLanes(),e=t.length-1;e>=0;e--)if(n=t[e],n.getOrder()==N)t.splice(e,1);else if(n.getOrder()>N)for(n.setOrder(n.getOrder()-1),a=n.getNodes(),e=0;e<a.length;e++)a[e].setLaneNumber(n.getOrder());u=d.getMaxLaneIndex(r),N=d.getFirstEmptyLaneIndex(g.getLanes(),i,u)}if(s()){u=d.getMaxLaneIndex(r);var c=f.hasSideSwimLanes()?g.getLanes().length-2:g.getLanes().length-1,p=c-u;if(p>0){var m=!1;for(t=g.getLanes(),e=t.length-1;e>=0;e--)if(n=t[e],n.getOrder()>u&&n.getOrder()<=c&&s())t.splice(e,1),m=!0;else if(m&&f.hasSideSwimLanes()&&n.getOrder()===g.getLanes().length)for(n.setOrder(n.getOrder()-p),a=n.getNodes(),e=0;e<a.length;e++)a[e].setLaneNumber(n.getOrder())}if(f.hasSideSwimLanes()){var C=g.getLanes().length-1;if(n=g.getLanes()[C],n.isRightLane())for(n.setOrder(C),a=n.getNodes(),e=0;e<a.length;e++)a[e].setLaneNumber(n.getOrder())}}}}},l.initialize()}return c});