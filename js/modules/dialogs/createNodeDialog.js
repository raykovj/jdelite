define(["jquery","knockout","modules/graph/graphConstants","modules/diagram/diagramUtils","modules/settings/config","modules/controller/flowCache"],function(e,i,o,n,t,l){function a(){function i(e){if(e.getCaller().getDecisionRun()===o.decisionRun().CREATE){var i=l.getSelectedFlowType();return"Create New "+n.getFlowTypeName(i).replace("_","/")+" Node"}if(e.getCaller().getDecisionRun()===o.decisionRun().EDIT)return"Edit Decision Node Layout"}function t(e){e.getCaller().setDecisionRun(o.decisionRun().NONE)}var a=this,c=e("#newNodeNameId");a.initDialog=function(n){var l=e("#newNodeDialogId");l.dialog({autoOpen:!1,closeOnEscape:!0,width:300,show:{effect:"slideDown",duration:200},hide:{effect:"slideUp",duration:200},modal:!0,resizable:!1,title:"Create New Node",open:function(t,l){c.val(""),e("#newNodeButtonOK").button("option","disabled",!0),e(this).dialog("option","title",i(n)),c.blur(),c.focus(),n.getCaller().getDecisionRun()===o.decisionRun().CREATE&&n.getCaller().resetDecisionIndices(),e("#decision-layout").accordion({heightStyle:"content",active:0,animate:200})},buttons:[{id:"newNodeButtonOK",text:"OK",click:function(){a.proceed(n),e(this).dialog("close"),t(n)}},{text:"Cancel",autofocus:!0,click:function(){e(this).dialog("close"),t(n)}}]}),e(".ui-dialog-titlebar-close").hide(),e(document).on("click",".ui-widget-overlay",function(){l.dialog("close"),t(n)})},a.proceed=function(e){var i=e.getFlowController();if(e.getCaller().getDecisionRun()===o.decisionRun().CREATE){var n=e.getCaller().newNodeNameValue().trim();l.getSelectedFlowType()===o.flowType().DECISION?i.addNodeByName(n,e.getCaller().newDecisionInput(),e.getCaller().newDecisionEnds()):i.addNodeByName(n)}else if(e.getCaller().getDecisionRun()===o.decisionRun().EDIT){var t=e.getCaller().getEditedDecisionNode(),a=e.getCaller().newDecisionInput(),c=e.getCaller().newDecisionEnds();i.changeNodeDecisionEnds(t,a,c)}e.refreshDiagram()}}return new a});