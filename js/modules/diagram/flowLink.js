define("modules/diagram/flowLink",["modules/graph/graphEdge","modules/draw/draw","modules/geometry/rectangle","modules/geometry/point","modules/graph/segment","modules/graph/graphConstants","modules/diagram/diagramUtils","modules/settings/config","modules/core/jsUtils"],function(e,t,r,i,n,o,g,s,a){function l(a){e.call(this,a);var l,d=this,h=o.colors().EDGE,c=o.colors().EDGE_LIGHT,S=o.colors().EDGE_HLT,u=(o.colors().SGM_DRAGGED,o.colors().EDGE_SEL),m=o.colors().EDGE_LINE,p=(o.colors().EDGE_SHADE,-1);d.setOrder=function(e){p=e},d.getOrder=function(){return p};var f=-1;d.setDraggedOrder=function(e){f=e},d.getDraggedOrder=function(){return f},d.getLinkObject=function(){var e=d.getLinkObjectToSave(!1);return e.order=d.getOrder(),e.srcShift=d.getSourceShift(),e.trgShift=d.getTargetShift(),e.srcPortOrder=d.getSrcPortOrder(),e.trgPortOrder=d.getTrgPortOrder(),e.pipesOnly=d.hasPipesOnly(),e},d.getLinkObjectToSave=function(e){var t={};t.id=o.elementType().EDGE,t.source=d.getSourcePort().getNode().getName()+"/"+d.getSourcePort().getName(),t.target=d.getTargetPort().getNode().getName()+"/"+d.getTargetPort().getName(),t.name="["+t.source+"]-["+t.target+"]",t.srcSide=d.getSourceSide(),t.trgSide=d.getTargetSide(),t.type=d.getType();var r=e?d.getSegmentShiftsToSave():d.getSegmentShifts();return r.length>0&&(t.segmentShifts=r),t},d.isLinkVisible=function(){return d.isVisible()&&d.getSourcePort().getNode().isVisible()&&d.getTargetPort().getNode().isVisible()},d.highlightOnMouseMove=function(e){d.containsPoint(e)?(d.setHighlighted(!0),l=d.getName()):(d.setHighlighted(!1),l=void 0)},d.highlightOnMouseDrag=function(e){var t=!1;return d.containsPoint(e)?(d.setSelected(!0),t=!0):d.setSelected(!1),t},d.getTooltip=function(){return s.hasShowTooltip()?l:void 0};var y=[];d.copySegments=function(){y=[];for(var e=0;e<d.segments.length;e++){var t=new i(d.segments[e].getStartPoint().x,d.segments[e].getStartPoint().y),r=new i(d.segments[e].getEndPoint().x,d.segments[e].getEndPoint().y),o=new n(this,d.segments[e].getPipe(),null,d.segments[e].getType(),t,r);y.push(o)}},d.printLink=function(){var e=(d.getTotalShifts(),g.getLinkTypeName(d.getType())),t=d.getName();return t+="\ntype: "+e},d.getTotalShifts=function(){var e,t=d.getSegmentShifts(),r=[],i=[];for(e=0;e<t.length;e++){for(var n,o=t[e],g=0;g<r.length;g++)if(r[g].order===o.order){r[g].pipeShift+=o.pipeShift,n=!0;break}if(!n){var s={};s.order=o.order,s.pipeShift=o.pipeShift,r.push(s)}}for(e=0;e<r.length;e++)0!=r[e].pipeShift&&i.push(r[e]);return i},d.drawGraphics=function(e){if(d.isLinkVisible())if(d.drawMode===o.drawMode().SEGMENTS){var i=h;d.isHighlighted()&&(i=S),d.isSelected()&&(i=u),e.lineWidth=1,e.setLineDash(d.getType()===o.linkType().REF_LINK?[4,2]:[0,0]),e.strokeStyle=i;for(var n=0;n<d.segments.length;n++)d.segments[n].drawGraphics(e)}else if(d.drawMode===o.drawMode().LINE){e.lineWidth=1,e.setLineDash(d.getType()===o.linkType().REF_LINK?[4,2]:[0,0]),e.strokeStyle=m,e.beginPath();var g=d.getSourcePort().getConnectionPoint(),a=d.getSourcePort().getAttachmentPoint(),l=d.getTargetPort().getAttachmentPoint(),p=s.getLinkStyle()===o.linkStyle().DOUBLE_ARROW?a.x:g.x,T=s.getLinkStyle()===o.linkStyle().DOUBLE_ARROW?a.y:g.y;e.moveTo(p,T),e.lineTo(l.x,l.y),e.stroke()}else if(d.drawMode===o.drawMode().SEGMENT_DRAGGED&&f>0&&f<d.segments.length-1){e.lineWidth=1,e.setLineDash(d.getType()===o.linkType().REF_LINK?[4,2]:[0,0]),e.strokeStyle=c;for(var E=0;E<y.length;E++)y[E].drawGraphics(e);var P=d.segments[f];e.strokeStyle=S,e.beginPath();var k=d.getSourcePort().getConnectionPoint(),v=d.getSourcePort().getAttachmentPoint(),L=P.getStartPoint(),O=s.getLinkStyle()===o.linkStyle().DOUBLE_ARROW?v.x:k.x,D=s.getLinkStyle()===o.linkStyle().DOUBLE_ARROW?v.y:k.y;e.moveTo(O,D),e.lineTo(L.x,L.y),e.stroke(),e.strokeStyle=S,e.beginPath();var w=P.getEndPoint(),G=d.getTargetPort().getAttachmentPoint();e.moveTo(w.x,w.y),e.lineTo(G.x,G.y),e.stroke(),e.lineWidth=2;var N=L,R=w,_=new r(N.x-2,N.y-2,4,4),b=new r(R.x-2,R.y-2,4,4);e.setLineDash(d.getType()===o.linkType().REF_LINK?[4,2]:[0,0]),e.strokeStyle=m,P.drawGraphics(e),e.lineWidth=1,t.paintRectangle(e,_,m,m,1),t.paintRectangle(e,b,m,m,1)}}}return a.inherit(l,e),l});