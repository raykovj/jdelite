define("modules/diagram/flowNode",["modules/graph/graphNode","modules/draw/draw","modules/draw/drawUtils","modules/geometry/rectangle","modules/graph/graphConstants","modules/diagram/diagramUtils","modules/settings/config","modules/common/utils","modules/core/jsUtils"],function(e,t,o,r,i,n,a,l,s){function f(l,s){function f(e){var t=d.getRefInPortForName(i.portNames().REF_IN_PORT_LEFT_NAME),o=d.getRefInPortForName(i.portNames().REF_IN_PORT_RIGHT_NAME);if(a.getFlowDirection()===i.flow().VERTICAL){if(e.x<d.x+Math.floor(d.width/2)){if(o)return o}else if(t)return t}else if(a.getFlowDirection()===i.flow().HORIZONTAL)if(e.y<d.y+Math.floor(d.height/2)){if(t)return t}else if(o)return o}function g(e){var t=d.getRefOutPortForName(i.portNames().REF_OUT_PORT_LEFT_NAME),o=d.getRefOutPortForName(i.portNames().REF_OUT_PORT_RIGHT_NAME);if(a.getFlowDirection()===i.flow().VERTICAL){if(e.x<d.x+Math.floor(d.width/2)){if(o)return o}else if(t)return t}else if(a.getFlowDirection()===i.flow().HORIZONTAL)if(e.y<d.y+Math.floor(d.height/2)){if(t)return t}else if(o)return o}function T(e,t){for(var o=0;o<e.length;o++)e[o].setVisible(t)}function u(e){for(var t=d.getConnectionPorts(),o=0;o<t.length;o++)for(var r=t[o].getEdgesList(),i=0;i<r.length;i++)r[i].setDrawMode(e)}function p(e){if(d.getContentSize()){var t,r,n,l,s=i.contentViewExt().WIDTH,f=d.getFontHeight(e),g=d.getTextLeading(),T=o.getTextRectangle(d,e,f,g,s);n=T.width,l=T.height,a.hasShowTitleOnContent()&&(l+=f+g),t=d.x+Math.floor((d.width-n)/2),r=d.y+Math.floor((d.height-l)/2),e.fillStyle=i.colors().CONTENT_TEXT;var u=o.getContentLines();if(a.hasShowTitleOnContent()){var p=o.getTextTruncated(d.getName(),e,i.contentSize().WIDTH);u.splice(0,0,p)}for(var h=0;h<u.length;h++){var R=u[h],N=Math.floor(e.measureText(R).width),c=t+Math.floor((n-N)/2),P=r+f-2+(f+g)*h;e.fillText(R,c,P),0==h&&d.nameRect.setRectBounds(c,P-f,N,f+g)}return!0}return!1}e.call(this,l,s);var d=this,h=s===i.flowType().START||s===i.flowType().END?12:2,R=i.colors().NODE,N=i.colors().NODE_HLT,c=i.colors().NODE_SEL,P=void 0,O=void 0,w=i.drawState().NONE;d.nameRect=new r(0,0,0,0),d.initNode=function(){d.flowType===i.flowType().START?d.createMarkupOutPort(d.getPreferredOutputSide()):d.flowType===i.flowType().END?d.createMarkupInPort(d.getPreferredInputSide()):d.flowType===i.flowType().PROCESS||d.flowType===i.flowType().IN_OUT?(d.createMarkupInPort(d.getPreferredInputSide()),d.createMarkupOutPort(d.getPreferredOutputSide()),d.createRefInPort(i.portNames().REF_IN_PORT_LEFT_NAME,i.nodeSide().LEFT),d.createRefInPort(i.portNames().REF_IN_PORT_RIGHT_NAME,i.nodeSide().RIGHT),d.createRefOutPort(i.portNames().REF_OUT_PORT_LEFT_NAME,i.nodeSide().LEFT),d.createRefOutPort(i.portNames().REF_OUT_PORT_RIGHT_NAME,i.nodeSide().RIGHT)):d.flowType===i.flowType().LEFT_TOP?(d.createMarkupInPort(d.getPreferredInputSide()),d.createMarkupOutPort(d.getPreferredOutputSide()),a.getFlowDirection()===i.flow().VERTICAL?(d.createRefInPort(i.portNames().REF_IN_PORT_LEFT_NAME,i.nodeSide().LEFT),d.createRefOutPort(i.portNames().REF_OUT_PORT_LEFT_NAME,i.nodeSide().LEFT)):a.getFlowDirection()===i.flow().HORIZONTAL&&(d.createRefInPort(i.portNames().REF_IN_PORT_RIGHT_NAME,i.nodeSide().RIGHT),d.createRefOutPort(i.portNames().REF_OUT_PORT_RIGHT_NAME,i.nodeSide().RIGHT))):d.flowType===i.flowType().RIGHT_BOTTOM&&(d.createMarkupInPort(d.getPreferredInputSide()),d.createMarkupOutPort(d.getPreferredOutputSide()),a.getFlowDirection()===i.flow().VERTICAL?(d.createRefInPort(i.portNames().REF_IN_PORT_RIGHT_NAME,i.nodeSide().RIGHT),d.createRefOutPort(i.portNames().REF_OUT_PORT_RIGHT_NAME,i.nodeSide().RIGHT)):a.getFlowDirection()===i.flow().HORIZONTAL&&(d.createRefInPort(i.portNames().REF_IN_PORT_LEFT_NAME,i.nodeSide().LEFT),d.createRefOutPort(i.portNames().REF_OUT_PORT_LEFT_NAME,i.nodeSide().LEFT)))},d.getNodeObject=function(){var e={};e.id=i.elementType().NODE,e.name=d.getName(),e.type=n.getFlowTypeName(d.getFlowType()),e.levelNum=d.getLevelNumber(),e.laneNum=d.getLaneNumber(),e.contentText=d.getContentText();d.getConnectionPorts();return e},d.getAllLinks=function(){var e,t=[],o=d.getInputEdges(),r=d.getOutputEdges();for(e=0;e<o.length;e++)t.push(o[e]);for(e=0;e<r.length;e++)t.push(r[e]);return t},d.getNodeBounds=function(){var e=d.clone();return new r(e.x-10,e.y-10,e.width+20,e.height+20)},d.containsPoint=function(e){var t=d.getNodeBounds().hasPointInside(e);return t},d.getSelectedAtPoint=function(e){if(d.containsPoint(e))return this},d.setHighlightedAtPoint=function(e){var t=d.containsPoint(e);d.showMarkupPorts(t,e),a.hasShowRefHandles()&&(d.showRefPorts(t,e),d.locateRefPorts()),d.locateMarkupPorts(e);var o,r,i=!1,n=d.getConnectionPorts();for(r=0;r<n.length;r++)o=n[r],o.isVisible()&&o.containsPoint(e)?(o.setHighlighted(!0),P=o.getTooltip(),i=!0):o.setHighlighted(!1);for(n=d.getMarkupPorts(),r=0;r<n.length;r++)o=n[r],o.isVisible()&&o.hasPoint(e)?(o.setHighlighted(!0),P=o.getTooltip(),i=!0):o.setHighlighted(!1);for(n=d.getRefPorts(),r=0;r<n.length;r++)o=n[r],o.isVisible()&&o.hasPoint(e)?(o.setHighlighted(!0),P=o.getTooltip(),i=!0):o.setHighlighted(!1);d.containsPoint(e)?(d.setHighlighted(!i),i||(P=a.hasShowTooltip()?d.getName():void 0,O=d.nameRect.hasPointInside(e)?d.getName():void 0)):(d.setHighlighted(!1),P=void 0,O=void 0)},d.getTooltip=function(){return P},d.getNameTooltip=function(){return O},d.locateMarkupPorts=function(e){var t=(d.isLeftLaneNode()||d.isRightLaneNode(),6),o=(d.isLeftLaneNode()||d.isRightLaneNode(),6);d.markupInPort&&(a.getFlowDirection()===i.flow().VERTICAL?e.x<d.x+Math.floor(d.width/2)?d.markupInPort.getConnector().moveToXY(o,-t):d.markupInPort.getConnector().moveToXY(d.width-o,-t):a.getFlowDirection()===i.flow().HORIZONTAL&&(e.y<d.y+Math.floor(d.height/2)?d.markupInPort.getConnector().moveToXY(-t,o):d.markupInPort.getConnector().moveToXY(-t,d.height-o))),d.markupOutPort&&(a.getFlowDirection()===i.flow().VERTICAL?e.x<d.x+Math.floor(d.width/2)?d.markupOutPort.getConnector().moveToXY(o,d.height+t):d.markupOutPort.getConnector().moveToXY(d.width-o,d.height+t):a.getFlowDirection()===i.flow().HORIZONTAL&&(e.y<d.y+Math.floor(d.height/2)?d.markupOutPort.getConnector().moveToXY(d.width+t,o):d.markupOutPort.getConnector().moveToXY(d.width+t,d.height-o)))},d.showMarkupPorts=function(e,t){if(t)d.isLeftLaneNode()||d.isRightLaneNode()?a.getFlowDirection()===i.flow().VERTICAL?t.x<d.x+Math.floor(d.width/2)?(d.markupInPort&&d.markupInPort.setVisible(!d.isLeftLaneNode()&&e),d.markupOutPort&&d.markupOutPort.setVisible(!d.isLeftLaneNode()&&e)):(d.markupInPort&&d.markupInPort.setVisible(!!d.isLeftLaneNode()&&e),d.markupOutPort&&d.markupOutPort.setVisible(!!d.isLeftLaneNode()&&e)):a.getFlowDirection()===i.flow().HORIZONTAL&&(t.y<d.y+Math.floor(d.height/2)?(d.markupInPort&&d.markupInPort.setVisible(!d.isLeftLaneNode()&&e),d.markupOutPort&&d.markupOutPort.setVisible(!d.isLeftLaneNode()&&e)):(d.markupInPort&&d.markupInPort.setVisible(!!d.isLeftLaneNode()&&e),d.markupOutPort&&d.markupOutPort.setVisible(!!d.isLeftLaneNode()&&e))):(d.markupInPort&&d.markupInPort.setVisible(e),d.markupOutPort&&d.markupOutPort.setVisible(e));else for(var o=d.getMarkupPorts(),r=0;r<o.length;r++)o[r].setVisible(e)},d.locateRefPorts=function(){var e=d.isLeftLaneNode()||d.isRightLaneNode()?4:6,t=d.getRefInPortForName(i.portNames().REF_IN_PORT_LEFT_NAME),o=d.getRefOutPortForName(i.portNames().REF_OUT_PORT_LEFT_NAME),r=d.getRefInPortForName(i.portNames().REF_IN_PORT_RIGHT_NAME),n=d.getRefOutPortForName(i.portNames().REF_OUT_PORT_RIGHT_NAME);a.getFlowDirection()===i.flow().VERTICAL?(t&&t.getConnector().moveToXY(d.width+6,e),o&&o.getConnector().moveToXY(d.width+6,d.height-e),r&&r.getConnector().moveToXY(-6,e),n&&n.getConnector().moveToXY(-6,d.height-e)):a.getFlowDirection()===i.flow().HORIZONTAL&&(t&&t.getConnector().moveToXY(e,-6),o&&o.getConnector().moveToXY(d.width-e,-6),r&&r.getConnector().moveToXY(e,d.height+6),n&&n.getConnector().moveToXY(d.width-e,d.height+6))},d.showRefPorts=function(e,t){var o=d.getRefInPortForName(i.portNames().REF_IN_PORT_LEFT_NAME),r=d.getRefOutPortForName(i.portNames().REF_OUT_PORT_LEFT_NAME),n=d.getRefInPortForName(i.portNames().REF_IN_PORT_RIGHT_NAME),l=d.getRefOutPortForName(i.portNames().REF_OUT_PORT_RIGHT_NAME);a.getFlowDirection()===i.flow().VERTICAL?t.x<d.x+Math.floor(d.width/2)?(n&&n.setVisible(e),l&&l.setVisible(e),T(d.getRefLeftPorts(),!1)):(o&&o.setVisible(e),r&&r.setVisible(e),T(d.getRefRightPorts(),!1)):a.getFlowDirection()===i.flow().HORIZONTAL&&(t.y<d.y+Math.floor(d.height/2)?(o&&o.setVisible(e),r&&r.setVisible(e),T(d.getRefRightPorts(),!1)):(n&&n.setVisible(e),l&&l.setVisible(e),T(d.getRefLeftPorts(),!1)))},d.hideRefPorts=function(){for(var e=d.getRefPorts(),t=0;t<e.length;t++)e[t].setVisible(!1)},d.hasSelections=function(){var e,t=d.getInputPorts(),o=d.getOutputPorts();for(e=0;e<t.length;e++)if(t[e].isSelected())return!0;for(e=0;e<o.length;e++)if(o[e].isSelected())return!0;return!1},d.clearEditing=function(){},d.setDNDAcceptingPorts=function(e,t){var o=e.getDirection(),r=[];if(e.getType()===i.portType().LINK_CNX||e.getType()===i.portType().MARKUP)o===i.portDirection().OUT||o===i.portDirection().MARK_OUT?r=d.getAllUnconnectedInputPorts():o!=i.portDirection().IN&&o!=i.portDirection().MARK_IN||(r=d.getAllUnconnectedOutputPorts());else if(e.getType()===i.portType().LINK_REF||e.getType()===i.portType().REF)if(o===i.portDirection().REF_OUT||o===i.portDirection().OUT){var n=f(t);n&&r.push(n)}else if(o==i.portDirection().REF_IN||o==i.portDirection().IN){var a=g(t);a&&r.push(a)}for(var l=0;l<r.length;l++){var s=r[l];s.setDNDMode(i.dndMode().DESTINATION),s.setVisible(!0)}},d.resetDNDFlags=function(){for(var e=d.getAllPorts(),t=0;t<e.length;t++)e[t].setDNDMode(i.dndMode().NONE)},d.getAcceptingPortForPoint=function(e,t){var o=e.getDirection(),r=[];if(d.locateMarkupPorts(t),o===i.portDirection().OUT||o===i.portDirection().MARK_OUT||o===i.portDirection().REF_OUT){if(r=d.getAllUnconnectedInputPorts(),e.getType()==i.portType().LINK_REF||e.getType()==i.portType().REF){var n=f(t);n&&r.push(n)}}else if((o===i.portDirection().IN||o===i.portDirection().MARK_IN||o===i.portDirection().REF_IN)&&(r=d.getAllUnconnectedOutputPorts(),e.getType()==i.portType().LINK_REF||e.getType()==i.portType().REF)){var a=g(t);a&&r.push(a)}for(var l=0;l<r.length;l++){var s=r[l];if(s.getDNDShape().hasPointInside(t))return s}},d.setDrawState=function(e){w=e,u(e===i.drawState().DRAGGED?i.drawMode().LINE:e===i.drawState().IN_LAYOUT?i.drawMode().SEGMENTS:i.drawMode().NO_DRAW)},d.setSelected=function(e){e&&(d.highlighted=!1),d.selected=e},d.drawGraphics=function(e){if(d.isVisible()){e.lineWidth=1,e.setLineDash([0,0]);var o=R;d.isHighlighted()&&(o=N),d.isSelected()&&(o=c),e.strokeStyle=o,e.font=i.font().TEXT,d.flowType===i.flowType().START||d.flowType===i.flowType().END?e.fillStyle=i.colors().NODE_SE_BGNCOLOR:d.flowType===i.flowType().IN_OUT||d.flowType===i.flowType().LEFT_TOP||d.flowType===i.flowType().RIGHT_BOTTOM?e.fillStyle=i.colors().NODE_SQ_BGNCOLOR:e.fillStyle=i.colors().NODE_BGNCOLOR,d.flowType===i.flowType().IN_OUT?t.roundParallelogram(e,d.x,d.y,d.width,d.height,h,4):t.roundRect(e,d.x,d.y,d.width,d.height,h),p(e)||d.drawName(e),d.drawPorts(e)}},d.drawName=function(e){var t=d.getName(),o=(a.getFlowDirection(),i.flow().HORIZONTAL,4);t.length>o&&(t=t.substring(0,o)+".."),e.fillStyle="blue";var r=e.measureText(t).width,n=5,l=(a.getFlowDirection(),i.flow().HORIZONTAL,i.portStep().MIN,Math.round(d.x+Math.floor(d.width/2)-Math.floor(r/2)));n=d.getFontHeight(e);var s=d.y+Math.floor((d.height+n/2)/2);d.nameRect.setRectBounds(l,s-10,r,10),e.fillText(t,l,s)},d.drawPorts=function(e){var t,o=d.getInputPorts();for(t=0;t<o.length;t++)o[t].drawPort(e);var r=d.getOutputPorts();for(t=0;t<r.length;t++)r[t].drawPort(e);for(d.markupInPort&&d.markupInPort.drawPort(e),d.markupOutPort&&d.markupOutPort.drawPort(e),t=0;t<d.getRefInPorts().length;t++)d.getRefInPorts()[t].drawPort(e);for(t=0;t<d.getRefOutPorts().length;t++)d.getRefOutPorts()[t].drawPort(e)},d.initNode()}return s.inherit(f,e),f});